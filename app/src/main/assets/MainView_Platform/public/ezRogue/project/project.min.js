var data_a1e2fb4a_e986_4524_b0da_9b7ba7c0874d={main:{floorIds:["MT0"],floorPartitions:[],images:["bear.png","bg.jpg","brave.png","dragon.png","life0.png","lifeA.png","lifeB.png","lifeC.png","lifeD.png","lifeE.png","lifeF.png","winskin.png"],tilesets:["magictower.png"],animates:["hand","hit","silversword","sword","zone"],bgms:[],sounds:[],fonts:[],nameMap:{"确定":"confirm.mp3","取消":"cancel.mp3","操作失败":"error.mp3","光标移动":"cursor.mp3","打开界面":"open_ui.mp3","读档":"load.mp3","存档":"save.mp3","获得道具":"item.mp3","回血":"recovery.mp3","炸弹":"bomb.mp3","飞行器":"centerFly.mp3","开关门":"door.mp3","上下楼":"floor.mp3","跳跃":"jump.mp3","破墙镐":"pickaxe.mp3","破冰镐":"icePickaxe.mp3","宝石":"gem.mp3","阻激夹域":"zone.mp3","穿脱装备":"equip.mp3","背景音乐":"bgm.mp3","攻击":"attack.mp3","背景图":"bg.jpg","商店":"shop.mp3","领域":"zone"},levelChoose:null,equipName:["武器","盾牌"],startBgm:null,styles:{startBackground:"project/images/bg.jpg",startVerticalBackground:"project/images/bg.jpg",startLogoStyle:"color: blue",startButtonsStyle:"background-color: #32369F; opacity: 0.85; color: #FFFFFF; border: #FFFFFF 2px solid; caret-color: #FFD700;",statusLeftBackground:"url(project/materials/ground.png) repeat",statusTopBackground:"url(project/materials/ground.png) repeat",toolsBackground:"black",floorChangingStyle:"background-color: black; color: white",statusBarColor:[255,255,255,1],borderColor:[0,0,0,1],selectColor:[255,215,0,1],font:"Verdana"},splitImages:[{name:"dragon.png",width:384,height:96,prefix:"dragon_"}]},firstData:{title:"魔塔肉鸽简易版",name:"MotaRouge1",version:"Ver 3.0.0",floorId:"MT0",hero:{image:"brave.png",animate:false,name:"勇士",lv:1,hpmax:500,hp:500,manamax:-1,mana:0,atk:30,def:10,mdef:0,money:1,exp:0,equipment:[],items:{constants:{},tools:{},equips:{}},loc:{direction:"down",x:6,y:4},flags:{},followers:[],steps:0},startCanvas:[{type:"comment",text:"在这里可以用事件来自定义绘制标题界面的背景图等"},{type:"comment",text:"也可以直接切换到其他楼层（比如某个开始剧情楼层）进行操作。"},{type:"previewUI",action:[{type:"fillRect",x:0,y:0,width:"core._PX_ || core.__PIXELS__",height:"core._PY_ || core.__PIXELS__",style:[82,82,82,1]},{type:"setAttribute",align:"center"},{type:"fillBoldText",x:"(core._PX_ || core.__PIXELS__) / 2",y:80,style:[255,255,255,1],strokeStyle:[0,0,0,1],font:"bold 40px Verdana",text:"${core.firstData.title}"}]},{type:"setValue",name:"flag:selection",value:"0"},{type:"comment",text:"在右下方自绘一个对话框进行显示选择项"},{type:"previewUI",action:[{type:"fillRect",x:230,y:250,width:150,height:142,radius:10,style:[50,54,159,0.85]},{type:"strokeRect",x:230,y:250,width:150,height:142,radius:10,style:[255,255,255,1],lineWidth:2},{type:"fillBoldText",x:305,y:290,style:[255,255,255,1],font:"bold 25px Verdana",text:"开始游戏"},{type:"fillBoldText",x:305,y:330,font:"bold 25px Verdana",text:"读取存档"},{type:"fillBoldText",x:305,y:370,font:"bold 25px Verdana",text:"回放录像"}]},{type:"while",condition:"1",data:[{type:"drawSelector",image:"winskin.png",code:1,x:245,y:"261 + 40*flag:selection",width:120,height:40},{type:"wait",data:[{"case":"keyboard",keycode:"13,32","break":true,action:[{type:"switch",condition:"flag:selection",caseList:[{"case":"0",action:[{type:"comment",text:"在“开始游戏”确定"},{type:"break",n:1}]},{"case":"1",action:[{type:"comment",text:"在“读取存档”确定"},{type:"callLoad"}]},{"case":"2",action:[{type:"comment",text:"在“回放录像”确定"},{type:"if",condition:"(!core.isReplaying())","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}]}]}]}]},{"case":"keyboard",keycode:"38","break":true,action:[{type:"comment",text:"光标上键"},{type:"setValue",name:"flag:selection",value:"(flag:selection + 2) % 3"}]},{"case":"keyboard",keycode:"40","break":true,action:[{type:"comment",text:"光标下键"},{type:"setValue",name:"flag:selection",value:"(flag:selection + 1) % 3"}]},{"case":"mouse",px:[245,365],py:[261,300],"break":true,action:[{type:"comment",text:"点击“开始游戏”"},{type:"break",n:1}]},{"case":"mouse",px:[245,365],py:[301,340],"break":true,action:[{type:"comment",text:"点击“读取存档”"},{type:"callLoad"}]},{"case":"mouse",px:[245,365],py:[341,380],"break":true,action:[{type:"comment",text:"点击“播放录像”"},{type:"if",condition:"(!core.isReplaying())","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}]}]}]}]},{type:"setValue",name:"flag:selection",value:"null"},{type:"drawSelector",code:1},{type:"clearMap"},{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"if",condition:"(main.levelChoose.length == 0)","true":[{type:"comment",text:"没有难度选择：直接开始游戏"}],"false":[{type:"comment",text:"难度选择：作为样例，这里只提供了一个显示选择项。"},{type:"function","function":'function(){\nvar choices = [];\nmain.levelChoose.forEach(function (one) {\n\tchoices.push({\n\t\t"text": one.title || \'\',\n\t\t"action": [\n\t\t\t{ "type": "function", "function": "function() { core.status.hard = \'" + (one.name || \'\') + "\'; }" }\n\t\t]\n\t});\n})\ncore.insertAction({ "type": "choices", "choices": choices });\n}'},{type:"comment",text:"你也可以仿照上面的样例进行自己创建等待用户操作来处理不同的难度分歧。\n如需自己处理，请设置 core.status.hard \n（例如，自定义js脚本：core.status.hard = 'Easy' ）"}]},{type:"clearMap"},{type:"comment",text:"接下来会执行startText中的事件"},{type:"comment",text:"状态栏默认处于隐藏状态；可以使用“显示状态栏”事件进行显示。"}],startText:[{type:"comment",text:"初始剧情"},{type:"choices",text:"\t[ ]游戏模式",choices:[{text:"70层",color:[96,238,103,1],action:[{type:"while",condition:"1",data:[{type:"setValue",name:"flag:mode",value:"1"},{type:"setValue",name:"flag:val1",value:"(Math.floor((30-(Math.sqrt(core.rand(900))))))"},{type:"setValue",name:"flag:val2",value:"(Math.floor((30-(Math.sqrt(core.rand(900))))))"},{type:"setValue",name:"flag:val3",value:"(Math.floor((40-(Math.sqrt(core.rand(1600))))))"},{type:"choices",text:"\t[ ]选择天赋",choices:[{text:"攻击效力提升${flag:val1}%",color:[238,96,96,1],action:[{type:"setValue",name:"flag:atkboost",operator:"+=",value:"flag:val1"},{type:"break",n:1}]},{text:"防御效力提升${flag:val2}%",color:[96,189,238,1],action:[{type:"setValue",name:"flag:defboost",operator:"+=",value:"flag:val2"},{type:"break",n:1}]},{text:"刷新！",color:[255,255,255,1],action:[]}]}]}]},{text:"无尽",color:[223,238,96,1],action:[{type:"while",condition:"1",data:[{type:"setValue",name:"flag:mode",value:"2"},{type:"setValue",name:"flag:val1",value:"(Math.floor((30-(Math.sqrt(core.rand(900))))))"},{type:"setValue",name:"flag:val2",value:"(Math.floor((30-(Math.sqrt(core.rand(900))))))"},{type:"choices",text:"\t[ ]选择天赋",choices:[{text:"攻击效力提升${flag:val1}%",color:[238,96,96,1],action:[{type:"setValue",name:"flag:atkboost",operator:"+=",value:"flag:val1"},{type:"break",n:1}]},{text:"防御效力提升${flag:val2}%",color:[96,189,238,1],action:[{type:"setValue",name:"flag:defboost",operator:"+=",value:"flag:val2"},{type:"break",n:1}]},{text:"刷新！",color:[255,255,255,1],action:[]}]}]}]}]},"计分方式：\n到达层数x100w\n血限x1\n攻防和x20\n护盾x5"],shops:[{id:"shop1",text:"\t[贪婪之神,moneyShop]勇敢的武士啊, 给我${20+2*flag:shop1}金币就可以：",textInList:"1F金币商店",mustEnable:false,disablePreview:false,choices:[{text:"生命+800",need:"status:money>=20+2*flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+2*flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"800"}]},{text:"攻击+4",need:"status:money>=20+2*flag:shop1",action:[{type:"setValue",name:"status:money",operator:"-=",value:"20+2*flag:shop1"},{type:"setValue",name:"flag:shop1",operator:"+=",value:"1"},{type:"setValue",name:"status:atk",operator:"+=",value:"4"}]}]},{id:"shop2",text:"\t[贪婪之神,expShop]勇敢的武士啊, 给我一定经验就可以：",textInList:"1F经验商店",mustEnable:false,disablePreview:true,choices:[{text:"等级+1（100经验）",need:"status:exp>=100",action:[{type:"setValue",name:"status:exp",operator:"-=",value:"100"},{type:"setValue",name:"status:lv",operator:"+=",value:"1"},{type:"setValue",name:"status:hp",operator:"+=",value:"1000"}]}]},{id:"itemShop",item:true,textInList:"道具商店",use:"money",mustEnable:false,choices:[{id:"yellowKey",number:10,money:"10",sell:"5"}]},{id:"keyShop",textInList:"回收钥匙商店",mustEnable:false,commonEvent:"回收钥匙商店"}],levelUp:[{need:"0",title:"",action:[{type:"comment",text:"此处是初始等级，只需填写称号"}]},{need:"20",title:"",action:[{type:"setValue",name:"status:atk",operator:"+=",value:"10"},{type:"setValue",name:"status:def",operator:"+=",value:"10"}]},{need:"40",title:"",action:[{type:"tip",text:"恭喜升级"}]}]},values:{lavaDamage:100,poisonDamage:10,weakValue:20,redGem:3,blueGem:3,greenGem:5,redPotion:100,bluePotion:250,yellowPotion:500,greenPotion:800,breakArmor:0.9,counterAttack:0.1,purify:3,hatred:2,animateSpeed:30000,moveSpeed:1000000,statusCanvasRowsOnMobile:3,floorChangeTime:100},flags:{statusBarItems:["enableHPMax","enableHP","enableAtk","enableDef","enableMDef","enableMoney"],autoScale:true,extendToolbar:false,flyNearStair:true,flyRecordPosition:false,itemFirstText:false,equipboxButton:false,enableAddPoint:true,enableNegativeDamage:false,betweenAttackMax:false,useLoop:false,startUsingCanvas:false,statusCanvas:false,enableEnemyPoint:true,enableGentleClick:true,ignoreChangeFloor:true,canGoDeadZone:false,enableMoveDirectly:true,enableRouteFolding:true,disableShopOnDamage:false,blurFg:false,hideLeftStatusBar:false}};var enemys_fcae963b_31c9_42b4_b48c_bb48d09f3f80={octopus:{name:"血影",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0,bigImage:"dragon_1.png"},princessEnemy:{name:"假公主",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},angel:{name:"天使",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},elemental:{name:"元素生物",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},steelGuard:{name:"铁守卫",hp:50,atk:50,def:50,money:0,exp:0,point:0,special:[18],value:20},evilBat:{name:"邪恶蝙蝠",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},dragon:{name:"魔龙",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0,bigImage:"dragon_0.png"},bearDown:{name:"熊出没",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[],faceIds:{down:"bearDown",left:"bearLeft",right:"bearRight",up:"bearUp"},bigImage:"bear.png"},bearLeft:{name:"熊出没",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[],faceIds:{down:"bearDown",left:"bearLeft",right:"bearRight",up:"bearUp"}},bearRight:{name:"熊出没",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[],faceIds:{down:"bearDown",left:"bearLeft",right:"bearRight",up:"bearUp"}},bearUp:{name:"熊出没",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[],faceIds:{down:"bearDown",left:"bearLeft",right:"bearRight",up:"bearUp"}},E1:{name:"绿头怪",hp:0,atk:0,def:0,money:0,exp:0,point:1,special:0},E2:{name:"红头怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[16,18],value:10},E3:{name:"青头怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E4:{name:"小蝙蝠",hp:100,atk:120,def:0,money:2,exp:0,point:0,special:[1]},E5:{name:"骷髅人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E6:{name:"初级法师",hp:100,atk:120,def:0,money:3,exp:0,point:1,special:[9]},E7:{name:"大蝙蝠",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E8:{name:"骷髅士兵",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E9:{name:"兽人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E10:{name:"初级卫兵",hp:100,atk:120,def:0,money:10,exp:0,point:0,special:0},E11:{name:"中级法师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E12:{name:"怪王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[1,9]},E13:{name:"红蝙蝠",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},E14:{name:"兽人武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E15:{name:"银头怪",hp:100,atk:120,def:0,money:15,exp:0,point:0,special:14},E16:{name:"黄头怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E17:{name:"石头人",hp:50,atk:50,def:0,money:3,exp:0,point:0,special:3},E18:{name:"骷髅队长",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E19:{name:"中级卫兵",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E20:{name:"金角怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E21:{name:"初级弓兵",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E22:{name:"寒蝙蝠",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E23:{name:"绿兽人",hp:100,atk:120,def:0,money:13,exp:0,point:0,special:[12]},E24:{name:"邪眼怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E25:{name:"高级法师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E26:{name:"影子战士",hp:100,atk:0,def:0,money:11,exp:0,point:0,special:[9],atkValue:2,defValue:3},E27:{name:"双手剑士",hp:100,atk:120,def:0,money:6,exp:0,point:0,special:4},E28:{name:"金骑士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E29:{name:"尖角怪",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E30:{name:"银怪王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E31:{name:"高级弓兵",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E32:{name:"冥战士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E33:{name:"冥队长",hp:200,atk:100,def:50,money:0,exp:0,point:0,special:8},E34:{name:"初级巫师",hp:100,atk:120,def:0,money:16,exp:0,point:0,special:15,value:100,range:2},E35:{name:"紫骷髅",hp:50,atk:60,def:70,money:80,exp:0,point:0,special:13},E36:{name:"紫蝙蝠",hp:100,atk:120,def:0,money:14,exp:0,point:0,special:13},E37:{name:"剑王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:[]},E38:{name:"水银战士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E39:{name:"金怪王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E40:{name:"灰色石头人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E41:{name:"红骑士",hp:500,atk:200,def:50,money:0,exp:0,point:0,special:[7]},E42:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E43:{name:"高级卫兵",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E44:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E45:{name:"高级巫师",hp:1000,atk:1200,def:0,money:160,exp:0,point:0,special:15,value:200,zoneSquare:true},E46:{name:"蓝骑士",hp:100,atk:120,def:0,money:9,exp:0,point:0,special:8},E47:{name:"铁面人",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E48:{name:"骷髅法师",hp:100,atk:100,def:0,money:0,exp:0,point:0,special:18,value:20},E49:{name:"白衣武士",hp:100,atk:120,def:0,money:17,exp:0,point:0,special:16},E50:{name:"混沌法师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E51:{name:"黑骑士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E52:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E53:{name:"黑暗仙子",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E54:{name:"卫兵队长",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E55:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E56:{name:"青衣武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E57:{name:"魔神武士",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E58:{name:"恶灵骑士",hp:150,atk:100,def:50,money:0,exp:0,point:0,special:[1,5,7,8]},E59:{name:"铃兰花妖",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E60:{name:"黄衣魔王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E61:{name:"骷髅王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E62:{name:"魔神法师",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E63:{name:"痛苦魔女",hp:1000,atk:0,def:0,money:0,exp:0,point:0,special:[10]},E64:{name:"郁金香花妖",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E65:{name:"红衣魔王",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E66:{name:"冥灵魔王",hp:888,atk:888,def:888,money:888,exp:888,point:0,special:[6],n:8},E67:{name:"黑暗大法师",hp:100,atk:120,def:0,money:12,exp:0,point:0,special:11,value:0.3333333333333333,add:true,notBomb:true},E68:{name:"黑衣魔王",hp:1000,atk:500,def:0,money:1000,exp:1000,point:0,special:0,notBomb:true},E69:{name:"剑圣",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0},E70:{name:"仙子",hp:0,atk:0,def:0,money:0,exp:0,point:0,special:0}};var icons_4665ee12_3a1f_44a4_bea3_0fccba634dc1={hero:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3},width:32,height:48},terrains:{ground:0,grass:1,grass2:2,ground2:3,ground3:4,downFloor:5,upFloor:6,blueShopLeft:7,pinkShopLeft:8,blueShopRight:9,pinkShopRight:10,arrowUp:11,arrowDown:12,arrowLeft:13,arrowRight:14,light:15,darkLight:16,ski:17,flower:18,box:19,boxed:20,sWallT:21,sWallL:22,sWallR:23,sWallB:24,sWallTL:25,sWallBR:26,sWallTR:27,sWallBL:28,sWallTB:29,sWallLR:30,sWallBLR:31,sWallTLR:32,sWallTBR:33,sWallTBL:34},animates:{star:0,lava:1,blueLava:2,water:3,yellowDoor:4,blueDoor:5,redDoor:6,greenDoor:7,specialDoor:8,steelDoor:9,yellowWall:10,whiteWall:11,blueWall:12,crystalUp:13,crystalBottom:14,starPortal:15,fire:16,portal:17,"switch":18,lavaNet:19,poisonNet:20,weakNet:21,curseNet:22,downPortal:23,leftPortal:24,rightPortal:25,upPortal:26,ice:27,magentaWall:28},npcs:{man:0,trader:1,thief:2,fairy:3,wizard:4,recluse:5,king:6,youngMan:7,sign:8,expShop:9,moneyShop:10,princess:11,greenMan:12,blueTrader:13},npc48:{npc0:0,npc1:1,npc2:2,npc3:3,tallYellowDoor:4,tallBlueDoor:5,tallRedDoor:6,tallGreenDoor:7,tallSpecialDoor:8,tallSteelDoor:9,N331:10,N332:11,N333:12},enemys:{octopus:57,princessEnemy:59,dragon:56,E1:0,E2:1,E3:2,E4:4,E5:8,E6:16,E7:5,E8:9,E9:12,E10:20,E11:52,E12:3,E13:6,E14:13,E15:47,E16:32,E17:14,E18:10,E19:21,E20:43,E21:64,E22:67,E23:55,E24:66,E25:17,E26:15,E27:23,E28:25,E29:49,E30:60,E31:65,E32:24,E33:11,E34:18,E35:33,E36:34,E37:53,E38:54,E39:61,E40:62,E41:26,E42:38,E43:22,E44:40,E45:19,E46:31,E47:35,E48:36,E49:45,E50:69,E51:27,E52:39,E53:51,E54:70,E55:63,E56:30,E57:41,E58:68,E59:71,E60:29,E61:37,E62:42,E63:50,E64:72,E65:44,E66:7,E67:46,E68:28,E69:48,E70:58},enemy48:{angel:0,elemental:1,steelGuard:2,evilBat:3,bearDown:4,bearLeft:5,bearRight:6,bearUp:7},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,steelKey:4,bigKey:6,redGem:16,blueGem:17,greenGem:18,yellowGem:19,redPotion:20,bluePotion:21,greenPotion:22,yellowPotion:23,lifeWand:33,sword0:60,sword1:50,sword2:51,sword3:52,sword4:53,sword5:54,shield0:61,shield1:55,shield2:56,shield3:57,shield4:58,shield5:59,book:9,fly:12,pickaxe:45,icePickaxe:44,bomb:43,centerFly:13,upFly:15,downFly:14,coin:11,freezeBadge:41,cross:40,superPotion:29,earthquake:8,poisonWine:24,weakWine:25,curseWine:27,superWine:28,dagger:42,amulet:47,hammer:48,jumpShoes:49,skill1:30,wand:10,pack:46},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0}};var maps_90f36752_8815_4be8_b32b_d7fad1d0542e={"1":{cls:"animates",id:"yellowWall",canBreak:true,animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{}}},"2":{cls:"animates",id:"whiteWall",canBreak:true,animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{}}},"3":{cls:"animates",id:"blueWall",canBreak:true,animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{}}},"4":{cls:"animates",id:"star",name:"星空"},"5":{cls:"animates",id:"lava",name:"岩浆"},"6":{cls:"animates",id:"ice",doorInfo:{time:160,openSound:"破冰镐",closeSound:"door.mp3",keys:{icePickaxe:1}},animate:1},"7":{cls:"terrains",id:"blueShopLeft"},"8":{cls:"terrains",id:"blueShopRight"},"9":{cls:"terrains",id:"pinkShopLeft"},"10":{cls:"terrains",id:"pinkShopRight"},"11":{cls:"animates",id:"lavaNet",canPass:true,trigger:"null",script:"(function () {\n\t// 血网的伤害效果移动到 checkBlock 中处理\n\n\t// 如果要做一次性血网，可直接注释掉下面这句话：\n\t// core.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n})();",name:"血网"},"12":{cls:"animates",id:"poisonNet",canPass:true,trigger:"null",script:"(function () {\n\tif (!core.hasItem('amulet')) {\n\t\tcore.triggerDebuff('get', 'poison');\n\t\tcore.updateStatusBar();\n\t}\n\n\t// 如果要做一次性毒网，可直接注释掉下面这句话：\n\t// core.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n})()",name:"毒网"},"13":{cls:"animates",id:"weakNet",canPass:true,trigger:"null",script:"(function () {\n\tif (!core.hasItem('amulet')) {\n\t\tcore.triggerDebuff('get', 'weak');\n\t\tcore.updateStatusBar();\n\t}\n\n\t// 如果要做一次性衰网，可直接注释掉下面这句话：\n\t// core.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n})()",name:"衰网"},"14":{cls:"animates",id:"curseNet",canPass:true,trigger:"null",script:"(function () {\n\tif (!core.hasItem('amulet')) {\n\t\tcore.triggerDebuff('get', 'curse');\n\t\tcore.updateStatusBar();\n\t}\n\n\t// 如果要做一次性咒网，可直接注释掉下面这句话：\n\t// core.removeBlock(core.getHeroLoc('x'), core.getHeroLoc('y'));\n})()",name:"咒网"},"15":{cls:"animates",id:"blueLava"},"16":{cls:"animates",id:"water"},"20":{cls:"autotile",id:"autotile"},"21":{cls:"items",id:"yellowKey"},"22":{cls:"items",id:"blueKey"},"23":{cls:"items",id:"redKey"},"24":{cls:"items",id:"greenKey"},"25":{cls:"items",id:"steelKey"},"26":{cls:"items",id:"bigKey"},"27":{cls:"items",id:"redGem"},"28":{cls:"items",id:"blueGem"},"29":{cls:"items",id:"greenGem"},"30":{cls:"items",id:"yellowGem"},"31":{cls:"items",id:"redPotion"},"32":{cls:"items",id:"bluePotion"},"33":{cls:"items",id:"greenPotion"},"34":{cls:"items",id:"yellowPotion"},"35":{cls:"items",id:"sword1"},"36":{cls:"items",id:"shield1"},"37":{cls:"items",id:"sword2"},"38":{cls:"items",id:"shield2"},"39":{cls:"items",id:"sword3"},"40":{cls:"items",id:"shield3"},"41":{cls:"items",id:"sword4"},"42":{cls:"items",id:"shield4"},"43":{cls:"items",id:"sword5"},"44":{cls:"items",id:"shield5"},"45":{cls:"items",id:"book"},"46":{cls:"items",id:"fly"},"47":{cls:"items",id:"pickaxe"},"48":{cls:"items",id:"icePickaxe"},"49":{cls:"items",id:"bomb"},"50":{cls:"items",id:"centerFly"},"51":{cls:"items",id:"upFly"},"52":{cls:"items",id:"downFly"},"53":{cls:"items",id:"coin"},"54":{cls:"items",id:"freezeBadge"},"55":{cls:"items",id:"cross"},"56":{cls:"items",id:"superPotion"},"57":{cls:"items",id:"earthquake"},"58":{cls:"items",id:"poisonWine"},"59":{cls:"items",id:"weakWine"},"60":{cls:"items",id:"curseWine"},"61":{cls:"items",id:"superWine"},"62":{cls:"items",id:"dagger"},"63":{cls:"items",id:"pack"},"64":{cls:"items",id:"amulet"},"65":{cls:"items",id:"hammer"},"68":{cls:"items",id:"lifeWand"},"69":{cls:"items",id:"jumpShoes"},"70":{cls:"items",id:"sword0"},"71":{cls:"items",id:"shield0"},"72":{cls:"items",id:"skill1"},"73":{cls:"items",id:"wand"},"81":{cls:"animates",id:"yellowDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{yellowKey:1}},name:"黄门"},"82":{cls:"animates",id:"blueDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{blueKey:1}},name:"蓝门"},"83":{cls:"animates",id:"redDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{redKey:1}},name:"红门"},"84":{cls:"animates",id:"greenDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1}},name:"绿门"},"85":{cls:"animates",id:"specialDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{specialKey:1}},name:"机关门"},"86":{cls:"animates",id:"steelDoor",trigger:"openDoor",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{steelKey:1}},name:"铁门"},"87":{cls:"terrains",id:"upFloor",canPass:true},"88":{cls:"terrains",id:"downFloor",canPass:true},"89":{cls:"animates",id:"portal",canPass:true},"90":{cls:"animates",id:"starPortal",canPass:true},"91":{cls:"animates",id:"upPortal",canPass:true},"92":{cls:"animates",id:"leftPortal",canPass:true},"93":{cls:"animates",id:"downPortal",canPass:true},"94":{cls:"animates",id:"rightPortal",canPass:true},"101":{cls:"animates",id:"crystalUp"},"102":{cls:"animates",id:"crystalBottom"},"103":{cls:"animates",id:"fire"},"104":{cls:"animates",id:"switch"},"109":{cls:"animates",id:"magentaWall",canBreak:true,animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{}}},"121":{cls:"npcs",id:"man"},"122":{cls:"npcs",id:"trader"},"123":{cls:"npcs",id:"thief"},"124":{cls:"npcs",id:"fairy"},"125":{cls:"npcs",id:"wizard"},"126":{cls:"npcs",id:"recluse"},"127":{cls:"npcs",id:"king"},"128":{cls:"npcs",id:"youngMan"},"129":{cls:"npcs",id:"sign"},"130":{cls:"npcs",id:"expShop"},"131":{cls:"npcs",id:"moneyShop"},"132":{cls:"npcs",id:"princess"},"133":{cls:"npc48",id:"npc0",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"},animate:1},"134":{cls:"npc48",id:"npc1",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"},animate:1},"135":{cls:"npc48",id:"npc2",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"},animate:1},"136":{cls:"npc48",id:"npc3",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"},animate:1},"137":{cls:"npcs",id:"greenMan"},"138":{cls:"npcs",id:"blueTrader"},"151":{cls:"autotile",id:"autotile1"},"152":{cls:"autotile",id:"autotile2"},"153":{cls:"autotile",id:"autotile3"},"161":{cls:"terrains",id:"arrowUp",canPass:true,cannotOut:["left","right","down"],cannotIn:["up"]},"162":{cls:"terrains",id:"arrowDown",canPass:true,cannotOut:["left","right","up"],cannotIn:["down"]},"163":{cls:"terrains",id:"arrowLeft",canPass:true,cannotOut:["up","down","right"],cannotIn:["left"]},"164":{cls:"terrains",id:"arrowRight",canPass:true,cannotOut:["up","down","left"],cannotIn:["right"]},"165":{cls:"terrains",id:"light",trigger:"null",canPass:true,script:"(function () {\n\tcore.setBlock(core.getNumberById('darkLight'), core.getHeroLoc('x'), core.getHeroLoc('y'));\n})();"},"166":{cls:"terrains",id:"darkLight"},"167":{cls:"terrains",id:"ski",trigger:"ski",canPass:true},"168":{cls:"terrains",id:"flower",canPass:true},"169":{cls:"terrains",id:"box",trigger:"pushBox"},"170":{cls:"terrains",id:"boxed",trigger:"pushBox"},"201":{cls:"enemys",id:"E1"},"202":{cls:"enemys",id:"E2"},"203":{cls:"enemys",id:"E3"},"204":{cls:"enemys",id:"E12"},"205":{cls:"enemys",id:"E4"},"206":{cls:"enemys",id:"E7"},"207":{cls:"enemys",id:"E13"},"208":{cls:"enemys",id:"E66"},"209":{cls:"enemys",id:"E5"},"210":{cls:"enemys",id:"E8"},"211":{cls:"enemys",id:"E18"},"212":{cls:"enemys",id:"E33"},"213":{cls:"enemys",id:"E9"},"214":{cls:"enemys",id:"E14"},"215":{cls:"enemys",id:"E17"},"216":{cls:"enemys",id:"E26"},"217":{cls:"enemys",id:"E6"},"218":{cls:"enemys",id:"E25"},"219":{cls:"enemys",id:"E34"},"220":{cls:"enemys",id:"E45"},"221":{cls:"enemys",id:"E10"},"222":{cls:"enemys",id:"E19"},"223":{cls:"enemys",id:"E43"},"224":{cls:"enemys",id:"E27"},"225":{cls:"enemys",id:"E32"},"226":{cls:"enemys",id:"E28"},"227":{cls:"enemys",id:"E41"},"228":{cls:"enemys",id:"E51"},"229":{cls:"enemys",id:"E68"},"230":{cls:"enemys",id:"E60"},"231":{cls:"enemys",id:"E56"},"232":{cls:"enemys",id:"E46"},"233":{cls:"enemys",id:"E16"},"234":{cls:"enemys",id:"E35"},"235":{cls:"enemys",id:"E36"},"236":{cls:"enemys",id:"E47"},"237":{cls:"enemys",id:"E48"},"238":{cls:"enemys",id:"E61"},"239":{cls:"enemys",id:"E42"},"240":{cls:"enemys",id:"E52"},"241":{cls:"enemys",id:"E44"},"242":{cls:"enemys",id:"E57"},"243":{cls:"enemys",id:"E62"},"244":{cls:"enemys",id:"E20"},"245":{cls:"enemys",id:"E65"},"246":{cls:"enemys",id:"E49"},"247":{cls:"enemys",id:"E67"},"248":{cls:"enemys",id:"E15"},"249":{cls:"enemys",id:"E69"},"250":{cls:"enemys",id:"E29"},"251":{cls:"enemys",id:"E63"},"252":{cls:"enemys",id:"E53"},"253":{cls:"enemys",id:"E11"},"254":{cls:"enemys",id:"E37"},"255":{cls:"enemys",id:"E38"},"256":{cls:"enemys",id:"E23"},"257":{cls:"enemys",id:"dragon"},"258":{cls:"enemys",id:"octopus"},"259":{cls:"enemys",id:"E70"},"260":{cls:"enemys",id:"princessEnemy"},"261":{cls:"enemy48",id:"angel"},"262":{cls:"enemy48",id:"elemental"},"263":{cls:"enemy48",id:"steelGuard"},"264":{cls:"enemy48",id:"evilBat"},"265":{cls:"enemys",id:"E30"},"266":{cls:"enemys",id:"E39"},"267":{cls:"enemys",id:"E40"},"270":{cls:"enemys",id:"E55"},"271":{cls:"enemys",id:"E21"},"272":{cls:"enemys",id:"E31"},"275":{cls:"enemys",id:"E24"},"277":{cls:"enemys",id:"E22"},"278":{cls:"enemys",id:"E58"},"279":{cls:"enemys",id:"E50"},"280":{cls:"enemys",id:"E54"},"300":{cls:"terrains",id:"ground"},"301":{cls:"terrains",id:"sWallT",name:"薄墙-上",cannotOut:["up"],cannotIn:["up"]},"302":{cls:"terrains",id:"sWallL",name:"薄墙-左",cannotOut:["left"],cannotIn:["left"]},"303":{cls:"terrains",id:"sWallR",name:"薄墙-右",cannotOut:["right"],cannotIn:["right"]},"304":{cls:"terrains",id:"sWallB",name:"薄墙-下",cannotOut:["down"],cannotIn:["down"]},"305":{cls:"terrains",id:"grass"},"306":{cls:"terrains",id:"sWallTL",name:"薄墙-上左",cannotOut:["up","left"],cannotIn:["up","left"]},"307":{cls:"terrains",id:"sWallBR",name:"薄墙-下右",cannotOut:["down","right"],cannotIn:["down","right"]},"308":{cls:"terrains",id:"grass2"},"309":{cls:"terrains",id:"sWallTR",name:"薄墙-上右",cannotOut:["up","right"],cannotIn:["up","right"]},"310":{cls:"terrains",id:"sWallBL",name:"薄墙-下左",cannotOut:["down","left"],cannotIn:["down","left"]},"311":{cls:"terrains",id:"ground2"},"312":{cls:"terrains",id:"sWallTB",name:"薄墙-上下",cannotOut:["up","down"],cannotIn:["up","down"]},"313":{cls:"terrains",id:"ground3"},"314":{cls:"terrains",id:"sWallLR",name:"薄墙-左右",cannotOut:["left","right"],cannotIn:["left","right"]},"315":{cls:"terrains",id:"sWallBLR",name:"薄墙-下左右",cannotOut:["down","left","right"],cannotIn:["down","left","right"]},"316":{cls:"terrains",id:"sWallTLR",name:"薄墙-上左右",cannotOut:["up","left","right"],cannotIn:["up","left","right"]},"317":{cls:"terrains",id:"sWallTBR",name:"薄墙-上下右",cannotOut:["up","down","right"],cannotIn:["up","down","right"]},"318":{cls:"terrains",id:"sWallTBL",name:"薄墙-上下左",cannotOut:["up","down","left"],cannotIn:["up","down","left"]},"319":{cls:"npc48",id:"tallYellowDoor",trigger:"openDoor",name:"高黄门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{yellowKey:1}}},"320":{cls:"npc48",id:"tallBlueDoor",trigger:"openDoor",name:"高蓝门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{blueKey:1}}},"321":{cls:"npc48",id:"tallRedDoor",trigger:"openDoor",name:"高红门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{redKey:1}}},"322":{cls:"npc48",id:"tallGreenDoor",trigger:"openDoor",name:"高绿门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{greenKey:1}}},"323":{cls:"npc48",id:"tallSpecialDoor",trigger:"openDoor",name:"高机关门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{specialKey:1}}},"324":{cls:"npc48",id:"tallSteelDoor",trigger:"openDoor",name:"高铁门",animate:1,doorInfo:{time:160,openSound:"door.mp3",closeSound:"door.mp3",keys:{steelKey:1}},faceIds:{down:"tallSteelDoor",left:"N331",right:"N332",up:"N333"}},"325":{cls:"enemys",id:"E59"},"326":{cls:"enemys",id:"E64"},"327":{cls:"enemy48",id:"bearDown"},"328":{cls:"enemy48",id:"bearLeft"},"329":{cls:"enemy48",id:"bearRight"},"330":{cls:"enemy48",id:"bearUp"},"331":{cls:"npc48",id:"N331",faceIds:{down:"tallSteelDoor",left:"N331",right:"N332",up:"N333"},animate:1},"332":{cls:"npc48",id:"N332",faceIds:{down:"tallSteelDoor",left:"N331",right:"N332",up:"N333"},animate:1},"333":{cls:"npc48",id:"N333",faceIds:{down:"tallSteelDoor",left:"N331",right:"N332",up:"N333"},animate:1}};var items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a={yellowKey:{cls:"tools",name:"黄钥匙",text:"可以打开一扇黄门",hideInToolbox:true},blueKey:{cls:"tools",name:"蓝钥匙",text:"可以打开一扇蓝门",hideInToolbox:true},redKey:{cls:"tools",name:"红钥匙",text:"可以打开一扇红门",hideInToolbox:true},redGem:{cls:"items",name:"红宝石",text:"攻击+${core.values.redGem}",itemEffect:"core.status.hero.atk += core.values.redGem * core.status.thisMap.ratio",itemEffectTip:"，攻击+${core.values.redGem * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.atk += core.values.redGem",canUseItemEffect:"true"},blueGem:{cls:"items",name:"蓝宝石",text:"，防御+${core.values.blueGem}",itemEffect:"core.status.hero.def += core.values.blueGem * core.status.thisMap.ratio",itemEffectTip:"，防御+${core.values.blueGem * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.def += core.values.blueGem",canUseItemEffect:"true"},greenGem:{cls:"items",name:"绿宝石",text:"，护盾+${core.values.greenGem}",itemEffect:"core.status.hero.mdef += core.values.greenGem * core.status.thisMap.ratio",itemEffectTip:"，护盾+${core.values.greenGem * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.mdef += core.values.greenGem",canUseItemEffect:"true"},yellowGem:{cls:"items",name:"黄宝石",text:"可以进行加点",itemEffect:"core.status.hero.hp+=1000;core.status.hero.atk+=6;core.status.hero.def+=6;core.status.hero.mdef+=10;",itemEffectTip:"，全属性提升",useItemEvent:[{type:"choices",choices:[{text:"攻击+1",action:[{type:"setValue",name:"status:atk",operator:"+=",value:"1"}]},{text:"防御+2",action:[{type:"setValue",name:"status:def",operator:"+=",value:"2"}]},{text:"生命+200",action:[{type:"setValue",name:"status:hp",operator:"+=",value:"200"}]}]}],canUseItemEffect:"true"},redPotion:{cls:"items",name:"红血瓶",text:"，生命+${core.values.redPotion}",itemEffect:"core.status.hero.hp += core.values.redPotion * core.status.thisMap.ratio",itemEffectTip:"，生命+${core.values.redPotion * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.hp += core.values.redPotion",canUseItemEffect:"true"},bluePotion:{cls:"items",name:"蓝血瓶",text:"，生命+${core.values.bluePotion}",itemEffect:"core.status.hero.hp += core.values.bluePotion * core.status.thisMap.ratio",itemEffectTip:"，生命+${core.values.bluePotion * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.hp += core.values.bluePotion",canUseItemEffect:"true"},yellowPotion:{cls:"items",name:"黄血瓶",text:"，生命+${core.values.yellowPotion}",itemEffect:"core.status.hero.hp += core.values.yellowPotion * core.status.thisMap.ratio",itemEffectTip:"，生命+${core.values.yellowPotion * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.hp += core.values.yellowPotion",canUseItemEffect:"true"},greenPotion:{cls:"items",name:"绿血瓶",text:"，生命+${core.values.greenPotion}",itemEffect:"core.status.hero.hp += core.values.greenPotion * core.status.thisMap.ratio",itemEffectTip:"，生命+${core.values.greenPotion * core.status.thisMap.ratio}",useItemEffect:"core.status.hero.hp += core.values.greenPotion",canUseItemEffect:"true"},sword0:{cls:"items",name:"破旧的剑",text:"一把已经生锈的剑",equip:{type:0,animate:"sword",value:{atk:0}},itemEffect:"core.status.hero.atk += 0",itemEffectTip:"，攻击+0"},sword1:{cls:"items",name:"铁剑",text:"一把很普通的铁剑",equip:{type:0,animate:"sword",value:{atk:10}},itemEffect:"core.status.hero.atk += 10",itemEffectTip:"，攻击+10"},sword2:{cls:"items",name:"银剑",text:"一把很普通的银剑",equip:{type:0,animate:"sword",value:{atk:20}},itemEffect:"core.status.hero.atk += 20",itemEffectTip:"，攻击+20"},sword3:{cls:"items",name:"骑士剑",text:"一把很普通的骑士剑",equip:{type:0,animate:"sword",value:{atk:40}},itemEffect:"core.status.hero.atk += 40",itemEffectTip:"，攻击+40"},sword4:{cls:"items",name:"圣剑",text:"一把很普通的圣剑",equip:{type:0,animate:"sword",value:{atk:80}},itemEffect:"core.status.hero.atk += 80",itemEffectTip:"，攻击+80"},sword5:{cls:"items",name:"神圣剑",text:"一把很普通的神圣剑",equip:{type:0,animate:"sword",value:{atk:160}},itemEffect:"core.status.hero.atk += 100",itemEffectTip:"，攻击+100"},shield0:{cls:"items",name:"破旧的盾",text:"一个很破旧的铁盾",equip:{type:1,value:{def:0}},itemEffect:"core.status.hero.def += 0",itemEffectTip:"，防御+0"},shield1:{cls:"items",name:"铁盾",text:"一个很普通的铁盾",equip:{type:1,value:{def:10}},itemEffect:"core.status.hero.def += 10",itemEffectTip:"，防御+10"},shield2:{cls:"items",name:"银盾",text:"一个很普通的银盾",equip:{type:1,value:{def:20}},itemEffect:"core.status.hero.def += 20",itemEffectTip:"，防御+20"},shield3:{cls:"items",name:"骑士盾",text:"一个很普通的骑士盾",equip:{type:1,value:{def:40}},itemEffect:"core.status.hero.def += 40",itemEffectTip:"，防御+40"},shield4:{cls:"items",name:"圣盾",text:"一个很普通的圣盾",equip:{type:1,value:{def:80}},itemEffect:"core.status.hero.def += 80",itemEffectTip:"，防御+80"},shield5:{cls:"items",name:"神圣盾",text:"一个很普通的神圣盾",equip:{type:1,value:{def:100,mdef:100}},itemEffect:"core.status.hero.def += 100;core.status.hero.mdef += 100",itemEffectTip:"，防御+100，护盾+100"},superPotion:{cls:"items",name:"圣水",itemEffect:"core.status.hero.hp *= 2",itemEffectTip:"，生命值翻倍",useItemEffect:"core.status.hero.hp *= 2;core.playSound('回血');",canUseItemEffect:"true",text:"生命值翻倍"},book:{cls:"constants",name:"怪物手册",text:"可以查看当前楼层各怪物属性",hideInToolbox:true,useItemEffect:"core.ui.drawBook(0);",canUseItemEffect:"true"},fly:{cls:"constants",name:"楼层传送器",text:"可以自由往来去过的楼层",hideInReplay:true,hideInToolbox:true,useItemEffect:"core.ui.drawFly(core.floorIds.indexOf(core.status.floorId));",canUseItemEffect:"(function () {\n\tif (core.flags.flyNearStair && !core.nearStair()) return false;\n\treturn core.status.maps[core.status.floorId].canFlyFrom;\n})();"},coin:{cls:"constants",name:"幸运金币",text:"持有时打败怪物可得双倍金币"},freezeBadge:{cls:"constants",name:"冰冻徽章",text:"可以将面前的熔岩变成平地",useItemEffect:"(function () {\n\tvar success = false;\n\n\tvar snowFourDirections = false; // 是否多方向雪花；如果是将其改成true\n\tif (snowFourDirections) {\n\t\t// 多方向雪花\n\t\tfor (var direction in core.utils.scan) { // 多方向雪花默认四方向，如需改为八方向请将这两个scan改为scan2\n\t\t\tvar delta = core.utils.scan[direction];\n\t\t\tvar nx = core.getHeroLoc('x') + delta.x,\n\t\t\t\tny = core.getHeroLoc('y') + delta.y;\n\t\t\tif (core.getBlockId(nx, ny) == 'lava') {\n\t\t\t\tcore.removeBlock(nx, ny);\n\t\t\t\tsuccess = true;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (core.getBlockId(core.nextX(), core.nextY()) == 'lava') {\n\t\t\tcore.removeBlock(core.nextX(), core.nextY());\n\t\t\tsuccess = true;\n\t\t}\n\t}\n\n\tif (success) {\n\t\tcore.playSound('打开界面');\n\t\tcore.drawTip(core.material.items[itemId].name + '使用成功', itemId);\n\t} else {\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip(\"当前无法使用\" + core.material.items[itemId].name, itemId);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n})();",canUseItemEffect:"true"},cross:{cls:"constants",name:"十字架",text:"持有后无视怪物的无敌属性"},dagger:{cls:"constants",name:"屠龙匕首",text:"该道具尚未被定义"},amulet:{cls:"constants",name:"护符",text:"持有时无视负面地形"},bigKey:{cls:"tools",name:"大黄门钥匙",text:"可以开启当前层所有黄门",itemEffect:"core.addItem('yellowKey', 1);\ncore.addItem('blueKey', 1);\ncore.addItem('redKey', 1);",itemEffectTip:"，全钥匙+1",useItemEffect:'(function () {\n\tvar actions = core.searchBlock("yellowDoor").map(function (block) {\n\t\treturn { "type": "openDoor", "loc": [block.x, block.y], "async": true };\n\t});\n\tactions.push({ "type": "waitAsync" });\n\tactions.push({ "type": "tip", "text": core.material.items[itemId].name + "使用成功" });\n\tcore.insertAction(actions);\n})();',canUseItemEffect:"(function () {\n\treturn core.searchBlock('yellowDoor').length > 0;\n})();"},greenKey:{cls:"tools",name:"绿钥匙",text:"可以打开一扇绿门"},steelKey:{cls:"tools",name:"铁门钥匙",text:"可以打开一扇铁门"},pickaxe:{cls:"tools",name:"破墙镐",text:"可以破坏勇士面前的墙",useItemEffect:"(function () {\n\tvar canBreak = function (x, y) {\n\t\tvar block = core.getBlock(x, y);\n\t\tif (block == null || block.disable) return false;\n\t\treturn block.event.canBreak;\n\t};\n\n\tvar success = false;\n\tvar pickaxeFourDirections = false; // 是否多方向破；如果是将其改成true\n\tif (pickaxeFourDirections) {\n\t\t// 多方向破\n\t\tfor (var direction in core.utils.scan) { // 多方向破默认四方向，如需改成八方向请将这两个scan改为scan2\n\t\t\tvar delta = core.utils.scan[direction];\n\t\t\tvar nx = core.getHeroLoc('x') + delta.x,\n\t\t\t\tny = core.getHeroLoc('y') + delta.y;\n\t\t\tif (canBreak(nx, ny)) {\n\t\t\t\tcore.removeBlock(nx, ny);\n\t\t\t\tsuccess = true;\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// 仅破当前\n\t\tif (canBreak(core.nextX(), core.nextY())) {\n\t\t\tcore.removeBlock(core.nextX(), core.nextY());\n\t\t\tsuccess = true;\n\t\t}\n\t}\n\n\tif (success) {\n\t\tcore.playSound('破墙镐');\n\t\tcore.drawTip(core.material.items[itemId].name + '使用成功', itemId);\n\t} else {\n\t\t// 无法使用\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip(\"当前无法使用\" + core.material.items[itemId].name, itemId);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n})();",canUseItemEffect:"true"},icePickaxe:{cls:"tools",name:"破冰镐",text:"可以破坏勇士面前的一堵冰墙",useItemEffect:'(function () {\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\', itemId);\n\tcore.insertAction({ "type": "openDoor", "loc": ["core.nextX()", "core.nextY()"] });\n})();',canUseItemEffect:"(function () {\n\treturn core.getBlockId(core.nextX(), core.nextY()) == 'ice';\n})();"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物",useItemEffect:"(function () {\n\tvar bombList = []; // 炸掉的怪物坐标列表\n\tvar todo = []; // 炸弹后事件\n\tvar money = 0,\n\t\texp = 0; // 炸弹获得的金币和经验\n\n\tvar canBomb = function (x, y) {\n\t\tvar block = core.getBlock(x, y);\n\t\tif (block == null || block.disable || block.event.cls.indexOf('enemy') != 0) return false;\n\t\tvar enemy = core.material.enemys[block.event.id];\n\t\treturn enemy && !enemy.notBomb;\n\t};\n\n\tvar bomb = function (x, y) {\n\t\tif (!canBomb(x, y)) return;\n\t\tbombList.push([x, y]);\n\t\tvar id = core.getBlockId(x, y),\n\t\t\tenemy = core.material.enemys[id];\n\t\tmoney += core.getEnemyValue(enemy, 'money', x, y) || 0;\n\t\texp += core.getEnemyValue(enemy, 'exp', x, y) || 0;\n\t\tcore.push(todo, core.floors[core.status.floorId].afterBattle[x + \",\" + y]);\n\t\tcore.push(todo, enemy.afterBattle);\n\t\tcore.removeBlock(x, y);\n\t}\n\n\t// 如果要多方向可炸，把这里的false改成true\n\tif (false) {\n\t\tvar scan = core.utils.scan; // 多方向炸时默认四方向，如果要改成八方向炸可以改成 core.utils.scan2\n\t\tfor (var direction in scan) {\n\t\t\tvar delta = scan[direction];\n\t\t\tbomb(core.getHeroLoc('x') + delta.x, core.getHeroLoc('y') + delta.y);\n\t\t}\n\t} else {\n\t\t// 仅炸当前\n\t\tbomb(core.nextX(), core.nextY());\n\t}\n\n\tif (bombList.length == 0) {\n\t\tcore.playSound('操作失败');\n\t\tcore.drawTip('当前无法使用' + core.material.items[itemId].name, itemId);\n\t\tcore.addItem(itemId, 1);\n\t\treturn;\n\t}\n\n\tcore.playSound('炸弹');\n\tcore.drawTip(core.material.items[itemId].name + '使用成功', itemId);\n\n\t// 取消这里的注释可以炸弹后获得金币和经验\n\t// core.status.hero.money += money;\n\t// core.status.hero.exp += exp;\n\n\t// 取消这里的注释可以炸弹引发战后事件\n\t// if (todo.length > 0) core.insertAction(todo);\n\n})();",canUseItemEffect:"true"},centerFly:{cls:"tools",name:"中心对称飞行器",text:"可以飞向当前楼层中心对称的位置",useItemEffect:"core.playSound('centerFly.mp3');\ncore.clearMap('hero');\ncore.setHeroLoc('x', core.bigmap.width - 1 - core.getHeroLoc('x'));\ncore.setHeroLoc('y', core.bigmap.height - 1 - core.getHeroLoc('y'));\ncore.drawHero();\ncore.drawTip(core.material.items[itemId].name + '使用成功');",canUseItemEffect:"(function () {\n\tvar toX = core.bigmap.width - 1 - core.getHeroLoc('x'),\n\t\ttoY = core.bigmap.height - 1 - core.getHeroLoc('y');\n\tvar id = core.getBlockId(toX, toY);\n\treturn id == null;\n})();"},upFly:{cls:"tools",name:"上楼器",text:"可以飞往楼上的相同位置",useItemEffect:'(function () {\n\tvar floorId = core.floorIds[core.floorIds.indexOf(core.status.floorId) + 1];\n\tif (core.status.event.id == \'action\') {\n\t\tcore.insertAction([\n\t\t\t{ "type": "changeFloor", "loc": [core.getHeroLoc(\'x\'), core.getHeroLoc(\'y\')], "floorId": floorId },\n\t\t\t{ "type": "tip", "text": core.material.items[itemId].name + \'使用成功\' }\n\t\t]);\n\t} else {\n\t\tcore.changeFloor(floorId, null, core.status.hero.loc, null, function () {\n\t\t\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\t\tcore.replay();\n\t\t});\n\t}\n})();',canUseItemEffect:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index < core.floorIds.length - 1) {\n\t\tvar toId = core.floorIds[index + 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();"},downFly:{cls:"tools",name:"下楼器",text:"可以飞往楼下的相同位置",useItemEffect:'(function () {\n\tvar floorId = core.floorIds[core.floorIds.indexOf(core.status.floorId) - 1];\n\tif (core.status.event.id == \'action\') {\n\t\tcore.insertAction([\n\t\t\t{ "type": "changeFloor", "loc": [core.getHeroLoc(\'x\'), core.getHeroLoc(\'y\')], "floorId": floorId },\n\t\t\t{ "type": "tip", "text": core.material.items[itemId].name + \'使用成功\' }\n\t\t]);\n\t} else {\n\t\tcore.changeFloor(floorId, null, core.status.hero.loc, null, function () {\n\t\t\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\t\tcore.replay();\n\t\t});\n\t}\n})();',canUseItemEffect:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index > 0) {\n\t\tvar toId = core.floorIds[index - 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙",useItemEffect:"(function () {\n\tvar indexes = [];\n\tfor (var index in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[index];\n\t\tif (!block.disable && block.event.canBreak) {\n\t\t\tindexes.push(index);\n\t\t}\n\t}\n\tcore.removeBlockByIndexes(indexes);\n\tcore.redrawMap();\n\tcore.playSound('炸弹');\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n})();",canUseItemEffect:"(function () {\n\treturn core.status.thisMap.blocks.filter(function (block) {\n\t\treturn !block.disable && block.event.canBreak;\n\t}).length > 0;\n})();"},poisonWine:{cls:"tools",name:"解毒药水",text:"可以解除中毒状态",useItemEffect:"core.triggerDebuff('remove', 'poison');",canUseItemEffect:"core.hasFlag('poison');"},weakWine:{cls:"tools",name:"解衰药水",text:"可以解除衰弱状态",useItemEffect:"core.triggerDebuff('remove', 'weak');",canUseItemEffect:"core.hasFlag('weak');"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态",useItemEffect:"core.triggerDebuff('remove', 'curse');",canUseItemEffect:"core.hasFlag('curse');"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态",useItemEffect:"core.triggerDebuff('remove', ['poison', 'weak', 'curse']);",canUseItemEffect:"(function() {\n\treturn core.hasFlag('poison') || core.hasFlag('weak') || core.hasFlag('curse');\n})();"},hammer:{cls:"tools",name:"圣锤",text:"该道具尚未被定义"},lifeWand:{cls:"tools",name:"生命魔杖",text:"可以恢复100点生命值",useItemEvent:[{type:"comment",text:"先恢复一个魔杖（因为使用道具必须消耗一个）"},{type:"function","function":"function(){\ncore.addItem('lifeWand', 1);\n}"},{type:"playSound",name:"打开界面"},{type:"input",text:"请输入生命魔杖使用次数：(0-${item:lifeWand})"},{type:"comment",text:"【接受用户输入】弹窗输入的结果将会保存在“flag:input”中\n如果需要更多帮助，请查阅帮助文档"},{type:"if",condition:"flag:input<=item:lifeWand","true":[{type:"setValue",name:"item:lifeWand",operator:"-=",value:"flag:input"},{type:"setValue",name:"status:hp",operator:"+=",value:"flag:input*100"},{type:"playSound",name:"回血"},"成功使用${flag:input}次生命魔杖，恢复${flag:input*100}点生命。"],"false":[{type:"playSound",name:"操作失败"},"输入不合法！"]}],canUseItemEffect:"true"},jumpShoes:{cls:"tools",name:"跳跃靴",text:"能跳跃到前方两格处",useItemEffect:'core.playSound("跳跃");\ncore.insertAction({ "type": "jumpHero", "loc": [core.nextX(2), core.nextY(2)] });',canUseItemEffect:"(function () {\n\tvar nx = core.nextX(2),\n\t\tny = core.nextY(2);\n\treturn nx >= 0 && nx < core.bigmap.width && ny >= 0 && ny < core.bigmap.height && core.getBlockId(nx, ny) == null;\n})();"},skill1:{cls:"constants",name:"技能：二倍斩",text:"可以打开或关闭主动技能二倍斩",hideInReplay:true,useItemEffect:"(function () {\n\tvar skillValue = 1; // 技能的flag:skill值，可用于当前开启技能的判定；对于新技能可以依次改成2，3等等\n\tvar skillNeed = 5; // 技能的需求\n\tvar skillName = '二倍斩'; // 技能的名称\n\n\tif (core.getFlag('skill', 0) != skillValue) { // 判断当前是否已经开了技能\n\t\tif (core.getStatus('mana') >= skillNeed) { // 这里要写当前能否开技能的条件判断，比如魔力值至少要多少\n\t\t\tcore.playSound('打开界面');\n\t\t\tcore.setFlag('skill', skillValue); // 开技能1\n\t\t\tcore.setFlag('skillName', skillName); // 设置技能名\n\t\t} else {\n\t\t\tcore.playSound('操作失败');\n\t\t\tcore.drawTip('魔力不足，无法开启技能');\n\t\t}\n\t} else { // 关闭技能\n\t\tcore.setFlag('skill', 0); // 关闭技能状态\n\t\tcore.setFlag('skillName', '无');\n\t}\n})();",canUseItemEffect:"true"},wand:{cls:"items",name:"新物品"},pack:{cls:"items",name:"钱袋",itemEffect:"core.status.hero.money += 500",itemEffectTip:"，金币+500"}};var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(d,c,a,f,g){core.clearStatus();core.status=core.clone(core.initStatus,function(h){return h!="hero"&&h!="maps"});core.control._bindRoutePush();core.status.played=true;core.status.hero=core.clone(d);window.hero=core.status.hero;window.flags=core.status.hero.flags;core.events.setHeroIcon(core.status.hero.image,true);core.control._initStatistics(core.animateFrame.totalTime);core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime);core.status.hero.statistics.start=null;core.status.hard=c||"";core.status.floorId=a;core.status.maps=f;core.maps._resetFloorImages();core.material.enemys=core.enemys.getEnemys();core.material.items=core.items.getItems();core.values=core.clone(core.data.values);for(var e in g||{}){core.values[e]=g[e]}core.flags=core.clone(core.data.flags);var b=core.getFlag("globalFlags",{});for(var e in b){core.flags[e]=b[e]}core._init_sys_flags();core.resize();if(core.hasFlag("hideStatusBar")){core.hideStatusBar(core.hasFlag("showToolbox"))}else{core.showStatusBar()}core.dom.musicBtn.style.display="none"},win:function(c,b,a){core.status.hero.hpmax=1e+19;core.status.hero.hp=core.getFlag("score");if(a){core.status.extraEvent=core.clone(core.status.event)}core.ui.closePanel();var d=core.isReplaying();if(d){core.stopReplay()}core.waitHeroToStop(function(){if(!a){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML=""}c=core.replaceText(c);core.drawText(["\t["+(c||"恭喜通关")+"]你的分数是"+core.getStatus("hp")+"!"],function(){core.events.gameOver(c||"",d,b)})})},lose:function(a){return;core.ui.closePanel();var b=core.isReplaying();core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t["+(a||"结局1")+"]你死了。\n如题。"],function(){core.events.gameOver(null,b)})})},changingFloor:function(d,f){var c=core.status.floorId||null;var e=core.hasFlag("__fromLoad__");var g=core.hasFlag("__isFlying__");if(!e&&!(g&&c==d)){if(!core.hasFlag("__leaveLoc__")){core.setFlag("__leaveLoc__",{})}if(c!=null){core.getFlag("__leaveLoc__")[c]=core.clone(core.status.hero.loc)}}if(core.autoRemoveMaps){core.autoRemoveMaps(d)}core.maps.resizeMap(d);f.direction=core.turnDirection(f.direction);core.status.hero.loc=f;if(!e){core.extractBlocks(d);core.status.maps[d].blocks.forEach(function(i){if(i.disable&&core.enemys.hasSpecial(i.event.id,23)){i.disable=false;core.setMapBlockDisabled(d,i.x,i.y,false);core.maps._updateMapArray(d,i.x,i.y)}});core.control.gatherFollowers()}core.drawMap(d);if(core.status.maps[d].bgm){var a=core.status.maps[d].bgm;if(a instanceof Array){a=a[Math.floor(Math.random()*a.length)]}if(!core.hasFlag("__bgm__")){core.playBgm(a)}}else{if(e&&!core.hasFlag("__bgm__")){core.pauseBgm()}}var b=core.getFlag("__color__",null);if(!b&&core.status.maps[d].color){b=core.status.maps[d].color}core.clearMap("curtain");core.status.curtainColor=b;if(b){core.fillRect("curtain",0,0,core._PX_||core.__PIXELS__,core._PY_||core.__PIXELS__,core.arrayToRGBA(b))}var h=core.getFlag("__weather__",null);if(!h&&core.status.maps[d].weather){h=core.status.maps[d].weather}if(h){core.setWeather(h[0],h[1])}else{core.setWeather()}},afterChangeFloor:function(a){if(core.hasFlag("__fromLoad__")){core.events.recoverEvents(core.getFlag("__events__"));core.removeFlag("__events__")}else{core.insertAction(core.floors[a].eachArrive);if(!core.hasVisitedFloor(a)){core.insertAction(core.floors[a].firstArrive);core.visitFloor(a)}}},flyTo:function(f,a){var b=core.status.floorId;if(!core.status.maps[b].canFlyFrom||!core.status.maps[f].canFlyTo||!core.hasVisitedFloor(f)){core.playSound("操作失败");core.drawTip("无法飞往"+core.status.maps[f].title+"！","fly");return false}var e=null,d=null;if(core.flags.flyRecordPosition){d=core.getFlag("__leaveLoc__",{})[f]||null}if(core.status.maps[f].flyPoint!=null&&core.status.maps[f].flyPoint.length==2){e="flyPoint"}if(e==null&&d==null){var c=core.floorIds.indexOf(b),g=core.floorIds.indexOf(f);var e=c<=g?"downFloor":"upFloor";if(c==g&&core.status.maps[b].underGround){e="upFloor"}}core.status.route.push("fly:"+f);core.ui.closePanel();core.setFlag("__isFlying__",true);core.changeFloor(f,e,d,null,function(){core.removeFlag("__isFlying__");if(a){a()}});return true},beforeBattle:function(c,f,g){if(f!=null&&g!=null){var e=f+","+g,b=core.status.checkBlock.cache[e]||{},d=b.guards||[];if(d.length>0){core.setFlag("__guards__"+f+"_"+g,d);var a=[{type:"playSound",name:"跳跃"}];d.forEach(function(h){core.push(a,{type:"jump",from:[h[0],h[1]],to:[f,g],time:300,keep:false,async:true})});core.push(a,[{type:"waitAsync"},{type:"setBlock",number:c,loc:[[f,g]]},{type:"battle",loc:[f,g]}]);core.insertAction(a);return false}}return true},afterBattle:function(e,p,q){var d=core.material.enemys[e];var m=d.special;var a="hand";var f=core.getEquip(0);if(f&&(core.material.items[f].equip||{}).animate){a=core.material.items[f].equip.animate}if(!(core.material.animates[a]||{}).se){core.playSound("attack.mp3")}if(p!=null&&q!=null){core.drawAnimate(a,p,q)}else{core.drawHeroAnimate(a)}var c=core.getDamageInfo(e,null,p,q)||{};var b=c.damage;var o=c.turn;if(b==null||b>=core.status.hero.hp){core.status.hero.hp=0;core.updateStatusBar(false,true);core.events.lose("战斗失败");return}core.status.hero.hp-=b;core.status.hero.statistics.battleDamage+=b;core.status.hero.statistics.battle++;var h=[];if(p!=null&&q!=null){h=core.getFlag("__guards__"+p+"_"+q,[]);core.removeFlag("__guards__"+p+"_"+q)}var j=h.reduce(function(r,s){return r+core.material.enemys[s[2]].money},core.getEnemyValue(d,"money",p,q));if(core.hasItem("coin")){j*=2}if(core.hasFlag("curse")){j=0}core.status.hero.money+=j;core.status.hero.statistics.money+=j;var g=h.reduce(function(r,s){return r+core.material.enemys[s[2]].exp},core.getEnemyValue(d,"exp",p,q));if(core.hasFlag("curse")){g=0}core.status.hero.exp+=g;core.status.hero.statistics.exp+=g;var i="打败 "+core.getEnemyValue(d,"name",p,q);if(core.flags.statusBarItems.indexOf("enableMoney")>=0){i+=","+core.getStatusLabel("money")+"+"+j}if(core.flags.statusBarItems.indexOf("enableExp")>=0){i+=","+core.getStatusLabel("exp")+"+"+g}core.drawTip(i,d.id);if(core.enemys.hasSpecial(m,12)){core.triggerDebuff("get","poison")}if(core.enemys.hasSpecial(m,13)){core.triggerDebuff("get","weak")}if(core.enemys.hasSpecial(m,14)){core.triggerDebuff("get","curse")}if(core.enemys.hasSpecial(m,17)){core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2))}if(core.enemys.hasSpecial(m,19)){core.status.hero.statistics.battleDamage+=core.status.hero.hp-1;core.status.hero.hp=1}if(core.enemys.hasSpecial(m,21)){core.status.hero.atk-=(d.atkValue||0);core.status.hero.def-=(d.defValue||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);if(core.flags.statusBarItems.indexOf("enableSkill")>=0){var l=core.getFlag("skill",0);if(l==1){core.status.hero.mana-=5}core.setFlag("skill",0);core.setFlag("skillName","无")}var n=[];var k=h.reduce(function(r,s){return r+core.material.enemys[s[2]].point},core.getEnemyValue(d,"point",p,q))||0;if(core.flags.enableAddPoint&&k>0){core.push(n,[{type:"insert",name:"加点事件",args:[k]}])}if(core.status.floorId!=null){core.push(n,core.floors[core.status.floorId].afterBattle[p+","+q])}core.push(n,d.afterBattle);if(n.length>0){core.insertAction(n,p,q)}delete ((flags.enemyOnPoint||{})[core.status.floorId]||{})[p+","+q];if(core.getBlock(p,q)!=null){if(core.hasSpecial(d.special,23)){core.hideBlock(p,q)}else{core.removeBlock(p,q)}}else{core.updateStatusBar()}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}},afterOpenDoor:function(b,d,e){var c=[];if(core.status.floorId){core.push(c,core.floors[core.status.floorId].afterOpenDoor[d+","+e])}var a=core.getBlockById(b);if(a&&a.event.doorInfo){core.push(c,a.event.doorInfo.afterOpenDoor)}if(c.length>0){core.insertAction(c,d,e)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}},afterGetItem:function(c,e,f,b){if(c.endsWith("Potion")&&core.material.items[c].cls=="items"){core.playSound("回血")}else{if(c.endsWith("Gem")&&core.material.items[c].cls=="items"){core.playSound("宝石")}else{core.playSound("获得道具")}}var d=[];if(core.status.floorId==null){return}var a=core.floors[core.status.floorId].afterGetItem[e+","+f];if(a&&(a instanceof Array||!b||!a.disableOnGentleClick)){if(a.data){a=a.data}core.unshift(d,a)}if(d.length>0){core.insertAction(d,e,f)}},afterPushBox:function(){if(core.searchBlock("box").length==0){}}},enemys:{getSpecials:function(){return[[1,"先攻","怪物首先攻击","#ffcc33"],[2,"魔攻","怪物无视角色的防御","#bbb0ff"],[3,"坚固","怪物防御不小于角色攻击-1","#c0b088"],[4,"2连击","怪物每回合攻击2次","#ffee77"],[5,"3连击","怪物每回合攻击3次","#ffee77"],[6,function(a){return(a.n||"")+"连击"},function(a){return"怪物每回合攻击"+(a.n||4)+"次"},"#ffee77"],[7,"破甲",function(a){return"战斗前，怪物附加角色防御的"+Math.floor(100*(a.breakArmor||core.values.breakArmor||0))+"%作为伤害"},"#88c0ff"],[8,"反击",function(a){return"战斗时，怪物每回合附加角色攻击的"+Math.floor(100*(a.counterAttack||core.values.counterAttack||0))+"%作为伤害，无视角色防御"},"#ffaa44"],[9,"净化",function(a){return"战斗前，怪物附加角色护盾的"+(a.purify||core.values.purify)+"倍作为伤害"},"#80eed6"],[10,"模仿","怪物的攻防和角色攻防相等","#b0c0dd"],[11,"吸血",function(a){return"战斗前，怪物首先吸取角色的"+Math.floor(100*a.vampire||0)+"%生命（约"+Math.floor((a.vampire||0)*core.getStatus("hp"))+"点）作为伤害"+(a.add?"，并把伤害数值加到自身生命上":"")},"#dd4448"],[12,"中毒","战斗后，角色陷入中毒状态，每一步损失生命"+core.values.poisonDamage+"点","#99ee88"],[13,"衰弱","战斗后，角色陷入衰弱状态，攻防暂时下降"+(core.values.weakValue>=1?core.values.weakValue+"点":parseInt(core.values.weakValue*100)+"%"),"#f0bbcc"],[14,"诅咒","战斗后，角色陷入诅咒状态，战斗无法获得金币和经验","#bbeef0"],[15,"领域",function(a){return"经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时自动减生命"+(a.zone||0)+"点"},"#c677dd"],[16,"夹击","经过两只相同的怪物中间，角色生命值变成一半","#bb99ee"],[17,"仇恨","战斗前，怪物附加之前积累的仇恨值作为伤害；战斗后，释放一半的仇恨值。（每杀死一个怪物获得"+(core.values.hatred||0)+"点仇恨值）","#b0b666"],[18,"阻击",function(a){return"经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"时自动减生命"+(a.repulse||0)+"点，同时怪物后退一格"},"#8888e6"],[19,"自爆","战斗后角色的生命值变成1","#ff6666"],[20,"无敌","角色无法打败怪物，除非拥有十字架","#aaaaaa"],[21,"退化",function(a){return"战斗后角色永久下降"+(a.atkValue||0)+"点攻击和"+(a.defValue||0)+"点防御"}],[22,"固伤",function(a){return"战斗前，怪物对角色造成"+(a.damage||0)+"点固定伤害，未开启负伤时无视角色护盾。"},"#ff9977"],[23,"重生","怪物被击败后，角色转换楼层则怪物将再次出现","#a0e0ff"],[24,"激光",function(a){return"经过怪物同行或同列时自动减生命"+(a.laser||0)+"点"},"#dda0dd"],[25,"光环",function(a){return(a.range!=null?((a.haloSquare?"该怪物九宫格":"该怪物十字")+a.haloRange+"格范围内"):"同楼层所有")+"怪物生命提升"+(a.hpBuff||0)+"%，攻击提升"+(a.atkBuff||0)+"%，防御提升"+(a.defBuff||0)+"%，"+(a.haloAdd?"可叠加":"不可叠加")},"#e6e099",1],[26,"支援","当周围一圈的怪物受到攻击时将上前支援，并组成小队战斗。","#77c0b6",1],[27,"捕捉",function(a){return"当走到怪物周围"+(a.zoneSquare?"九宫格":"十字")+"时会强制进行战斗。"},"#c0ddbb"]]},getEnemyInfo:function(d,g,v,w,e){e=e||core.status.floorId;var j=core.getRealStatusOrDefault(g,"hp"),h=core.getRealStatusOrDefault(g,"atk"),i=core.getRealStatusOrDefault(g,"def"),k=core.getRealStatusOrDefault(g,"mdef");var q=core.getEnemyValue(d,"hp",v,w,e),n=core.getEnemyValue(d,"atk",v,w,e),o=core.getEnemyValue(d,"def",v,w,e),t=core.getEnemyValue(d,"special",v,w,e);var r=core.getEnemyValue(d,"money",v,w,e),p=core.getEnemyValue(d,"exp",v,w,e),s=core.getEnemyValue(d,"point",v,w,e);if(core.hasSpecial(t,10)){n=h;o=i}if(core.hasSpecial(t,3)&&o<h-1){o=h-1}var f=[];if(!core.status.checkBlock){core.status.checkBlock={}}if(core.status.checkBlock.needCache){var l=0,a=0,c=0;var u={};var m=v!=null&&w!=null?(v+","+w):e;if(!core.status.checkBlock.cache){core.status.checkBlock.cache={}}var b=core.status.checkBlock.cache[m];if(!b){core.extractBlocks(e);core.status.maps[e].blocks.forEach(function(x){if(!x.disable){var B=x.event.id,A=core.material.enemys[B];if(A&&core.hasSpecial(A.special,25)){var C=A.haloRange==null;if(A.haloRange!=null&&v!=null&&w!=null){var y=Math.abs(x.x-v),z=Math.abs(x.y-w);if(y+z<=A.haloRange){C=true}if(A.haloSquare&&y<=A.haloRange&&z<=A.haloRange){C=true}}if(C&&(A.haloAdd||!u[A.id])){l+=A.hpBuff||0;a+=A.atkBuff||0;c+=A.defBuff||0;u[A.id]=true}}if(A&&core.hasSpecial(A.special,26)&&v!=null&&w!=null&&Math.abs(x.x-v)<=1&&Math.abs(x.y-w)<=1&&!(v==x.x&&w==x.y)){f.push([x.x,x.y,B])}}});core.status.checkBlock.cache[m]={hp_buff:l,atk_buff:a,def_buff:c,guards:f}}else{l=b.hp_buff;a=b.atk_buff;c=b.def_buff;f=b.guards}q*=(1+l/100);n*=(1+a/100);o*=(1+c/100)}return{hp:Math.floor(q),atk:Math.floor(n),def:Math.floor(o),money:Math.floor(r),exp:Math.floor(p),point:Math.floor(s),special:t,guards:f,}},getDamageInfo:function(c,l,I,J,e){e=e||core.status.floorId;var o=core.getRealStatusOrDefault(l,"hp"),m=core.getRealStatusOrDefault(l,"atk"),n=core.getRealStatusOrDefault(l,"def"),p=core.getRealStatusOrDefault(l,"mdef"),D=core.getStatusOrDefault(l,"hp"),B=core.getStatusOrDefault(l,"atk"),C=core.getStatusOrDefault(l,"def");o=Math.max(0,o);m=Math.max(0,m);n=Math.max(0,n);p=Math.max(0,p);m*=1+core.getFlag("atkboost")*0.01;n*=1+core.getFlag("defboost")*0.01;var d=core.enemys.getEnemyInfo(c,l,I,J,e);var w=d.hp,u=d.atk,v=d.def,A=d.special;var z=0;var F;if(core.getFlag("skill",0)==1){m*=2}if(core.hasSpecial(A,3)){v=Math.max(v,m-1)}if(core.hasSpecial(A,20)&&!core.hasItem("cross")){return null}if(core.hasSpecial(A,29)){z=p*c.value}var t=0;if(core.hasSpecial(A,11)){var H=o*c.value;H=Math.floor(H)||0;if(c.add){w+=H}t+=H}var E=u-n;var q=Math.max(m-v,0);if(core.hasSpecial(A,30)&&(m<v)){q=m}if(q<=0){return null}var G=Math.ceil((w+z)/q);if(core.hasSpecial(A,34)){G+=c.value}if(core.hasSpecial(A,32)&&G>c.n){G-=c.n;u*=(c.value||1)}if(core.hasSpecial(A,33)){G+=(E*(G-1))/q}if(core.hasSpecial(A,2)||(core.hasSpecial(A,30)&&(m>v))||(core.hasSpecial(A,31)&&(n>u))||((z>m)&&core.hasSpecial(A,29))){E=u}if(E<0){E=0}if(core.hasSpecial(A,4)){E*=2}if(core.hasSpecial(A,5)){E*=3}if(core.hasSpecial(A,6)){E*=(c.n||4)}var a=0;if(core.hasSpecial(A,8)){a+=Math.floor((c.atkValue||core.values.counterAttack)*m)}if(core.hasSpecial(A,1)){t+=E}if(core.hasSpecial(A,7)){t+=Math.floor((c.defValue||core.values.breakArmor)*n)}if(core.hasSpecial(A,9)){t+=Math.floor((c.n||core.values.purify)*p)}if(G<=0){G=1}if(flags.Oceaning){if(core.itemCount("O2")<G){return null}}var h=core.getFlag("__guards__"+I+"_"+J,d.guards);var g=false;G+=core.getFlag("__extraTurn__",0);if(h.length>0){if(!g){core.setFlag("__extraTurn__",G)}for(var r=0;r<h.length;r++){var j=h[r][0],k=h[r][1],f=h[r][2];var s=core.enemys.getDamageInfo(core.material.enemys[f],{hp:D,atk:B,def:C,mdef:0});if(s==null){core.removeFlag("__extraTurn__");return null}core.setFlag("__extraTurn__",s.turn);t+=s.damage}if(g){G+=core.getFlag("__extraTurn__",0)}}core.removeFlag("__extraTurn__");F=E*(G-1);if(core.hasSpecial(A,32)){if(G<=c.n){F=0}}var b=t+F+G*a;b-=p;if(!core.flags.enableNegativeDamage){b=Math.max(0,b)}if(core.hasSpecial(A,17)){b+=core.getFlag("hatred",0)}if(core.hasSpecial(A,22)){b+=c.damage||0}return{mon_hp:Math.floor(w),mon_atk:Math.floor(u),mon_def:Math.floor(v),init_damage:Math.floor(t),per_damage:Math.floor(E),hero_per_damage:Math.floor(q),turn:Math.floor(G),damage:Math.floor(b),}}},actions:{onKeyUp:function(d,a){if(core.isMoving()){return}if(core.status.onShopLongDown){return core.status.onShopLongDown=false}if(a&&d>=48&&d<=57){core.items.quickLoadEquip(d-48);return}switch(d){case 27:core.openSettings(true);break;case 88:core.openBook(true);break;case 71:core.useFly(true);break;case 65:core.doSL("autoSave","load");break;case 87:core.doSL("autoSave","reload");break;case 83:core.save(true);break;case 68:core.load(true);break;case 69:core.ui._drawCursor();break;case 84:core.openToolbox(true);break;case 81:core.openEquipbox(true);break;case 90:core.turnHero();break;case 86:core.openQuickShop(true);break;case 32:core.getNextItem();break;case 82:core.ui._drawReplay();break;case 33:case 34:core.ui._drawViewMaps();break;case 66:core.ui._drawStatistics();break;case 72:core.ui._drawHelp();break;case 77:core.actions._clickNotes_show();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:if(core.hasItem("pickaxe")){core.status.route.push("key:49");core.useItem("pickaxe",true)}break;case 50:if(core.hasItem("bomb")){core.status.route.push("key:50");core.useItem("bomb",true)}break;case 51:if(core.hasItem("centerFly")){core.ui._drawCenterFly()}break;case 52:var e=["icePickaxe","freezeBadge","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine"];for(var b=0;b<e.length;b++){var c=e[b];if(core.canUseItem(c)){core.status.route.push("key:52");core.useItem(c,true);break}}break;case 53:core.doSL("autoSave","load");break;case 54:core.doSL("autoSave","reload");break;case 55:core.getNextItem();break;case 118:case 119:core.debug();break;case 70:if(core.hasItem("skill1")){core.status.route.push("key:70");core.useItem("skill1",true)}break}},onStatusBarClick:function(b,c,d){var a=function(){if(core.isReplaying()&&d!=null){return d}return core.domStyle.isVertical};if(core.status.lockControl){return}if(core.isMoving()){return}}},control:{saveData:function(){var c={};for(var b in core.values){if(!core.same(core.values[b],core.data.values[b])){c[b]=core.clone(core.values[b])}}var a={floorId:core.status.floorId,hero:core.clone(core.status.hero),hard:core.status.hard,maps:core.clone(core.maps.saveMap()),route:core.encodeRoute(core.status.route),values:c,version:core.firstData.version,guid:core.getGuid(),time:new Date().getTime()};return a},loadData:function(b,a){core.resetGame(b.hero,b.hard,b.floorId,core.maps.loadMap(b.maps,null,b.hero.flags),b.values);core.status.route=core.decodeRoute(b.route);core.control._bindRoutePush();core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var d=core.getFlag("globalAttribute",core.status.globalAttribute);if(!core.same(d,core.status.globalAttribute)){core.status.globalAttribute=d;core.resize()}core.events.setVolume(core.getFlag("__volume__",1),0);var c=core.status.hero.image;c=core.getMappedName(c);if(core.material.images.images[c]){core.material.images.hero=core.material.images.images[c];core.material.icons.hero.width=core.material.images.images[c].width/4;core.material.icons.hero.height=core.material.images.images[c].height/4}core.setFlag("__fromLoad__",true);core.changeFloor(b.floorId,null,b.hero.loc,0,function(){if(core.hasFlag("__bgm__")){core.playBgm(core.getFlag("__bgm__"))}core.removeFlag("__fromLoad__");if(a){a()}})},getStatusLabel:function(a){return{name:"名称",lv:"等级",hpmax:"生命上限",hp:"生命",manamax:"魔力上限",mana:"魔力",atk:"攻击",def:"防御",mdef:"护盾",money:"金币",exp:"经验",point:"加点",steps:"步数",}[a]||a},triggerDebuff:function(a,c){if(!(c instanceof Array)){c=[c]}if(a=="get"){if(core.inArray(c,"poison")&&!core.hasFlag("poison")){core.setFlag("poison",true)}if(core.inArray(c,"weak")&&!core.hasFlag("weak")){core.setFlag("weak",true);if(core.values.weakValue>=1){core.addStatus("atk",-core.values.weakValue);core.addStatus("def",-core.values.weakValue)}else{core.addBuff("atk",-core.values.weakValue);core.addBuff("def",-core.values.weakValue)}}if(core.inArray(c,"curse")&&!core.hasFlag("curse")){core.setFlag("curse",true)}}else{if(a=="remove"){var b=false;if(core.inArray(c,"poison")&&core.hasFlag("poison")){b=true;core.setFlag("poison",false)}if(core.inArray(c,"weak")&&core.hasFlag("weak")){b=true;core.setFlag("weak",false);if(core.values.weakValue>=1){core.addStatus("atk",core.values.weakValue);core.addStatus("def",core.values.weakValue)}else{core.addBuff("atk",core.values.weakValue);core.addBuff("def",core.values.weakValue)}}if(core.inArray(c,"curse")&&core.hasFlag("curse")){b=true;core.setFlag("curse",false)}if(b){core.playSound("回血")}}}},updateStatusBar:function(){core.events.checkLvUp();if(core.flags.statusBarItems.indexOf("enableHPMax")>=0){core.setStatus("hp",Math.min(core.getRealStatus("hpmax"),core.getStatus("hp")))}if(core.status.floorId){core.setStatusBarInnerHTML("floor",core.status.maps[core.status.floorId].name)}core.setStatusBarInnerHTML("name",core.getStatus("name"));core.setStatusBarInnerHTML("lv",core.getLvName());var c=["hpmax","hp","mana","atk","def","mdef","money","exp"];c.forEach(function(d){core.status.hero[d]=Math.floor(core.status.hero[d]);core.setStatusBarInnerHTML(d,core.getRealStatus(d))});if(core.status.hero.manamax!=null&&core.getRealStatus("manamax")>=0){core.status.hero.mana=Math.min(core.status.hero.mana,core.getRealStatus("manamax"));core.setStatusBarInnerHTML("mana",core.status.hero.mana+"/"+core.getRealStatus("manamax"))}else{core.setStatusBarInnerHTML("mana",core.status.hero.mana)}core.setStatusBarInnerHTML("skill",core.getFlag("skillName","无"));if(core.flags.statusBarItems.indexOf("enableLevelUp")>=0){core.setStatusBarInnerHTML("up",core.formatBigNumber(core.getNextLvUpNeed())||"")}else{core.setStatusBarInnerHTML("up","")}var b=["yellowKey","blueKey","redKey","greenKey"];b.forEach(function(d){core.setStatusBarInnerHTML(d,core.setTwoDigits(core.itemCount(d)))});core.setStatusBarInnerHTML("poison",core.hasFlag("poison")?"毒":"");core.setStatusBarInnerHTML("weak",core.hasFlag("weak")?"衰":"");core.setStatusBarInnerHTML("curse",core.hasFlag("curse")?"咒":"");core.setStatusBarInnerHTML("pickaxe","破"+core.itemCount("pickaxe"));core.setStatusBarInnerHTML("bomb","炸"+core.itemCount("bomb"));core.setStatusBarInnerHTML("fly","飞"+core.itemCount("centerFly"));if(core.statusBar.hard.innerText!=core.status.hard){core.statusBar.hard.innerText=core.status.hard}var a=core.getFlag("__hardColor__");if(a==null){core.statusBar.hard.innerText=""}if(core.statusBar.hard.getAttribute("_style")!=a){core.statusBar.hard.style.color=a;core.statusBar.hard.setAttribute("_style",a)}core.drawStatusBar();core.updateCheckBlock();core.updateDamage()},updateCheckBlock:function(r){r=r||core.status.floorId;if(!r||!core.status.maps){return}var Q=core.floors[r].width,s=core.floors[r].height;var d=core.getMapBlocksObj(r);var i={},O={},F={},a={};var b={};var A=false;var g=core.flags.canGoDeadZone;core.flags.canGoDeadZone=true;for(var z in d){var c=d[z],R=c.x,T=c.y,t=c.event.id,m=core.material.enemys[t];if(c.disable){continue}O[z]=O[z]||{};if(t=="lavaNet"&&!core.hasItem("amulet")){i[z]=(i[z]||0)+core.values.lavaDamage;O[z][(c.event.name||"血网")+"伤害"]=true}if(m&&core.hasSpecial(m.special,15)&&!core.hasFlag("no_zone")){var D=m.range||1;var U=false;if(m.zoneSquare!=null){U=m.zoneSquare}for(var k=-D;k<=D;k++){for(var l=-D;l<=D;l++){if(k==0&&l==0){continue}var B=R+k,C=T+l,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}if(!U&&Math.abs(k)+Math.abs(l)>D){continue}i[h]=(i[h]||0)+(m.zone||0);O[h]=O[h]||{};O[h]["领域伤害"]=true}}}if(m&&core.hasSpecial(m.special,18)&&!core.hasFlag("no_repulse")){var K=m.zoneSquare?core.utils.scan2:core.utils.scan;for(var j in K){var B=R+K[j].x,C=T+K[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}i[h]=(i[h]||0)+(m.repulse||0);O[h]=O[h]||{};O[h]["阻击伤害"]=true;var E=core.turnDirection(":back",j);var I=R+K[E].x,J=T+K[E].y;if(I<0||I>=Q||J<0||J>=s){continue}if(core.getBlock(I,J,r,false)!=null){continue}if(core.utils.scan[E]&&!core.canMoveHero(R,T,E,r)){continue}F[h]=(F[h]||[]).concat([[R,T,t,E]])}}if(m&&core.hasSpecial(m.special,24)&&!core.hasFlag("no_laser")){for(var B=0;B<Q;B++){var h=B+","+T;if(B!=R){i[h]=(i[h]||0)+(m.laser||0);O[h]=O[h]||{};O[h]["激光伤害"]=true}}for(var C=0;C<s;C++){var h=R+","+C;if(C!=T){i[h]=(i[h]||0)+(m.laser||0);O[h]=O[h]||{};O[h]["激光伤害"]=true}}}if(m&&core.enemys.hasSpecial(m.special,27)&&!core.hasFlag("no_ambush")){var K=m.zoneSquare?core.utils.scan2:core.utils.scan;for(var j in K){var B=R+K[j].x,C=T+K[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s||(core.utils.scan[j]&&!core.canMoveHero(R,T,j,r))){continue}a[h]=(a[h]||[]).concat([[R,T,t,j]])}}if(m&&core.enemys.hasSpecial(m.special,16)&&!core.hasFlag("no_betweenAttack")){for(var j in core.utils.scan){var B=R+core.utils.scan[j].x,C=T+core.utils.scan[j].y,h=B+","+C;if(B<0||B>=Q||C<0||C>=s){continue}b[h]=true}}var L=core.getSpecialFlag(m);if(L&1){A=true}if(core.status.event.id=="viewMaps"){A=true}if((core.status.event.id=="book"||core.status.event.id=="bool-detail")&&core.status.event.ui){A=true}}for(var z in b){var S=z.split(","),R=parseInt(S[0]),T=parseInt(S[1]);var p=null,q=null;var u=d[(R-1)+","+T],G=d[(R+1)+","+T];var w=core.getFaceDownId(u),H=core.getFaceDownId(G);if(u&&!u.disable&&G&&!G.disable&&w==H){if(core.hasSpecial(w,16)){p=w}}var M=d[R+","+(T-1)],e=d[R+","+(T+1)];var N=core.getFaceDownId(M),f=core.getFaceDownId(e);if(M&&!M.disable&&e&&!e.disable&&N==f){if(core.hasSpecial(N,16)){q=N}}if(p!=null||q!=null){var v=core.status.hero.hp-(i[z]||0);if(v>1){var P=Math.floor(v/2);if(core.flags.betweenAttackMax){var n=core.getDamage(p,R,T,r);if(n!=null&&n<P){P=n}var o=core.getDamage(q,R,T,r);if(o!=null&&o<P){P=o}}if(P>0){i[z]=(i[z]||0)+P;O[z]=O[z]||{};O[z]["夹击伤害"]=true}}}}core.flags.canGoDeadZone=g;core.status.checkBlock={damage:i,type:O,repulse:F,ambush:a,needCache:A,cache:{}}},moveOneStep:function(b){core.status.hero.steps++;core.updateFollowers();core.drawHero();if(core.hasFlag("poison")){core.status.hero.statistics.poisonDamage+=core.values.poisonDamage;core.status.hero.hp-=core.values.poisonDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar(false,true);core.events.lose();return}else{core.updateStatusBar(false,true)}}core.checkAutoEvents();var d=core.getHeroLoc("x"),e=core.getHeroLoc("y");var a=core.getBlock(d,e);var c=false;if(a!=null&&a.event.trigger=="getItem"&&!core.floors[core.status.floorId].afterGetItem[d+","+e]){c=true;core.trigger(d,e,b)}core.checkBlock();if(!c){core.trigger(d,e,b)}if(core.onSki()){core.insertAction({type:"moveAction"},null,null,null,true)}},moveDirectly:function(d,e,b){if(b==null){b=core.canMoveDirectly(d,e)}if(b>=0){if(core.hasFlag("poison")){var a=b*core.values.poisonDamage;if(a>=core.status.hero.hp){return false}core.status.hero.statistics.poisonDamage+=a;core.status.hero.hp-=a}core.clearMap("hero");var c=core.status.route[core.status.route.length-1];if(["left","right","up","down"].indexOf(c)>=0){core.setHeroLoc("direction",c)}core.control._moveDirectyFollowers(d,e);core.status.hero.loc.x=d;core.status.hero.loc.y=e;core.drawHero();core.status.route.push("move:"+d+":"+e);core.status.hero.statistics.moveDirectly++;core.status.hero.statistics.ignoreSteps+=b;if(core.hasFlag("poison")){core.updateStatusBar(false,true)}core.ui.drawStatusBar();core.checkRouteFolding();return true}return false},parallelDo:function(timestamp){if(!core.isPlaying()){return}if(core.status.floorId){try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){console.error(e)}}}},ui:{getToolboxItems:function(a){return Object.keys(core.status.hero.items[a]||{}).filter(function(b){return !core.material.items[b].hideInToolbox}).sort()},drawStatusBar:function(){var a,b=function(e,f,g,d){core.ui.setFont(a,(/\w+/.test(e)?"italic ":"")+"bold 18px Verdana");core.ui.fillBoldText(a,e,f,g,d)};if(core.flags.statusCanvas){core.ui.clearMap(a=core.dom.statusCanvasCtx);core.ui.setFillStyle(a,core.status.globalAttribute.statusBarColor);if(core.domStyle.isVertical){core.drawImage(a,core.statusBar.icons.floor,6,6,25,25);b((core.status.thisMap||{}).name||"Loading",42,26);core.drawImage(a,core.statusBar.icons.hp,137,6,25,25);b(core.formatBigNumber(core.getRealStatus("hp")),173,26);core.drawImage(a,core.statusBar.icons.atk,268,6,25,25);b(core.formatBigNumber(core.getRealStatus("atk")),304,26);core.drawImage(a,core.statusBar.icons.def,6,38,25,25);b(core.formatBigNumber(core.getRealStatus("def")),42,58);core.drawImage(a,core.statusBar.icons.mdef,137,38,25,25);b(core.formatBigNumber(core.getRealStatus("mdef")),173,58);core.drawImage(a,core.statusBar.icons.money,268,38,25,25);b(core.formatBigNumber(core.status.hero.money),304,58);core.drawImage(a,core.statusBar.icons.exp,6,70,25,25);b(core.formatBigNumber(core.status.hero.exp),42,90)}else{if(!core.flags.hideLeftStatusBar){core.drawImage(a,core.statusBar.icons.floor,6,9,25,25);b((core.status.thisMap||{}).name||"Loading",42,29);core.drawImage(a,core.statusBar.icons.hp,6,43,25,25);b(core.formatBigNumber(core.getRealStatus("hp")),42,63);core.drawImage(a,core.statusBar.icons.atk,6,77,25,25);b(core.formatBigNumber(core.getRealStatus("atk")),42,97);core.drawImage(a,core.statusBar.icons.def,6,111,25,25);b(core.formatBigNumber(core.getRealStatus("def")),42,131);core.drawImage(a,core.statusBar.icons.mdef,6,145,25,25);b(core.formatBigNumber(core.getRealStatus("mdef")),42,165);core.drawImage(a,core.statusBar.icons.money,6,179,25,25);b(core.formatBigNumber(core.status.hero.money),42,199);core.drawImage(a,core.statusBar.icons.exp,6,213,25,25);b(core.formatBigNumber(core.status.hero.exp),42,233);b(core.setTwoDigits(core.itemCount("yellowKey")),11,267,"#FFCCAA");b(core.setTwoDigits(core.itemCount("blueKey")),46,267,"#AAAADD");b(core.setTwoDigits(core.itemCount("redKey")),81,267,"#FF8888")}}}else{if(core.flags.hideLeftStatusBar&&!core.domStyle.isVertical){if(!core.dymCanvas.status){core.ui.createCanvas("status",0,0,core._PX_,core._PY_,66)}core.ui.clearMap(a=core.dymCanvas.status);core.ui.setFillStyle(a,core.status.globalAttribute.statusBarColor);var c=core.status.hero.loc.x-core.bigmap.offsetX/32>=core._HEIGHT_?0:core._PY_;core.ui.setAlpha(a,0.75);core.ui.drawWindowSkin("winskin.png",a,c,0,core._PX_-core._PY_,core._PY_);core.ui.setAlpha(a,1);core.drawImage(a,core.statusBar.icons.floor,6+c,9,25,25);b((core.status.thisMap||{}).name||"Loading",42+c,29);core.drawImage(a,core.statusBar.icons.hp,6+c,43,25,25);b(core.formatBigNumber(core.getRealStatus("hp")),42+c,63);core.drawImage(a,core.statusBar.icons.atk,6+c,77,25,25);b(core.formatBigNumber(core.getRealStatus("atk")),42+c,97);core.drawImage(a,core.statusBar.icons.def,6+c,111,25,25);b(core.formatBigNumber(core.getRealStatus("def")),42+c,131);core.drawImage(a,core.statusBar.icons.mdef,6+c,145,25,25);b(core.formatBigNumber(core.getRealStatus("mdef")),42+c,165);core.drawImage(a,core.statusBar.icons.money,6+c,179,25,25);b(core.formatBigNumber(core.status.hero.money),42+c,199);core.drawImage(a,core.statusBar.icons.exp,6+c,213,25,25);b(core.formatBigNumber(core.status.hero.exp),42+c,233);b(core.setTwoDigits(core.itemCount("yellowKey")),11+c,267,"#FFCCAA");b(core.setTwoDigits(core.itemCount("blueKey")),46+c,267,"#AAAADD");b(core.setTwoDigits(core.itemCount("redKey")),81+c,267,"#FF8888")}}},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redGem","blueGem","greenGem","yellowGem","redPotion","bluePotion","greenPotion","yellowPotion","superPotion","pickaxe","bomb","centerFly","icePickaxe","freezeBadge","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine","sword1","sword2","sword3","sword4","sword5","shield1","shield2","shield3","shield4","shield5",]},drawAbout:function(){core.ui.closePanel();core.lockControl();core.status.event.id="about";var c=48,f=36,d=(core._PX_||core.__PIXELS__)-2*c,a=(core._PY_||core.__PIXELS__)-2*f;core.setAlpha("ui",0.85);core.fillRect("ui",c,f,d,a,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",c-1,f-1,d+1,a+1,"#FFFFFF",2);var e=c+24;core.setTextAlign("ui","left");var b=core.status.globalAttribute||core.initStatus.globalAttribute;core.fillText("ui","HTML5 魔塔样板",e,f+35,b.selectColor,"bold 22px "+b.font);core.fillText("ui","版本： "+main.__VERSION__,e,f+80,"#FFFFFF","bold 17px "+b.font);core.fillText("ui","作者： 艾之葵",e,f+112);core.fillText("ui","HTML5魔塔交流群：539113091",e,f+112+32);core.playSound("打开界面")}}};var events_c12a15a8_c380_4b28_8144_256cba95f760={commonEvent:{"加点事件":[{type:"comment",text:"通过传参，flag:arg1 表示当前应该的加点数值"},{type:"setValue",name:"flag:temprand",value:"core.rand(10)"},{type:"setValue",name:"flag:tem1",value:"core.rand(2)"},{type:"setValue",name:"flag:tem2",value:"core.rand(2)"},{type:"setValue",name:"flag:tem3",value:"core.rand(2)"},{type:"setValue",name:"flag:tem4",value:"core.rand(2)"},{type:"setValue",name:"flag:tem5",value:"core.rand(2)"},{type:"choices",text:"\t[选择你的属性增益！]",choices:[{text:"生命回满",color:[196,222,74,1],action:[{type:"setValue",name:"status:hp",value:"status:hpmax"},{type:"insert",name:"hp更新"}]},{text:"心之钢：随机提高生命上限（100-300）",color:[150,35,35,1],action:[{type:"setValue",name:"flag:temphealth",value:"100+10*Math.floor(core.rand(30))"},{type:"setValue",name:"status:hpmax",operator:"+=",value:"flag:temphealth"},{type:"setValue",name:"status:hp",operator:"+=",value:"flag:temphealth"},{type:"setValue",name:"status:hp",operator:"min=",value:"status:hpmax"},{type:"insert",name:"hp更新"}]},{text:"狂怒小刀：随机获得一些攻击(10-80) ",color:[220,74,74,1],action:[{type:"setValue",name:"flag:tempattack",value:"10+Math.floor(core.rand(70))"},{type:"setValue",name:"status:atk",operator:"+=",value:"flag:tempattack"},{type:"insert",name:"hp更新"}]},{text:"兰顿之兆：随机获得一些防御(10-80) ",color:[77,74,220,1],action:[{type:"setValue",name:"flag:tempattack",value:"10+Math.floor(core.rand(70))"},{type:"setValue",name:"status:def",operator:"+=",value:"flag:tempattack"},{type:"insert",name:"hp更新"}]},{text:"基克的救赎：随机获得一些护盾（10-100）",color:[194,74,220,1],action:[{type:"setValue",name:"flag:tempshelf",value:"10+Math.floor(core.rand(70))"},{type:"setValue",name:"status:mdef",operator:"+=",value:"flag:tempshelf"},{type:"insert",name:"hp更新"}]},{text:"三相之力：属性提高33，血量提高333",color:[239,119,25,1],condition:"core.rand(2)>1",action:[{type:"setValue",name:"status:atk",operator:"+=",value:"33"},{type:"setValue",name:"status:def",operator:"+=",value:"33"},{type:"setValue",name:"status:hpmax",operator:"+=",value:"flag:temphealth"},{type:"setValue",name:"status:hp",operator:"+=",value:"333"},{type:"setValue",name:"status:hp",operator:"min=",value:"status:hpmax"},{type:"insert",name:"hp更新"}]}]}],"回收钥匙商店":[{type:"comment",text:"此事件在全局商店中被引用了(全局商店keyShop)"},{type:"comment",text:"解除引用前勿删除此事件"},{type:"comment",text:"玩家在快捷列表（V键）中可以使用本公共事件"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[商人,trader]你有多余的钥匙想要出售吗？",choices:[{text:"黄钥匙（10金币）",color:[255,255,0,1],action:[{type:"if",condition:"item:yellowKey >= 1","true":[{type:"setValue",name:"item:yellowKey",operator:"-=",value:"1"},{type:"setValue",name:"status:money",operator:"+=",value:"10"}],"false":["\t[商人,trader]你没有黄钥匙！"]}]},{text:"蓝钥匙（50金币）",color:[0,0,255,1],action:[{type:"if",condition:"item:blueKey >= 1","true":[{type:"setValue",name:"item:blueKey",operator:"-=",value:"1"},{type:"setValue",name:"status:money",operator:"+=",value:"50"}],"false":["\t[商人,trader]你没有蓝钥匙！"]}]},{text:"离开",action:[{type:"exit"}]}]}]}],"战斗":[{type:"setValue",name:"flag:val0",value:"1"},{type:"setValue",name:"flag:morihp",value:"50"},{type:"setValue",name:"flag:mhp",value:"50"},{type:"setValue",name:"flag:matk",value:"15"},{type:"setValue",name:"flag:mdef",value:"5"},{type:"while",condition:"((flag:val0<=70)||(flag:mode===2))",data:[{type:"setValue",name:"flag:hatk",value:"(Math.floor((status:atk*(1+flag:atkboost*0.01))))"},{type:"setValue",name:"flag:hdef",value:"(Math.floor((status:def*(1+flag:defboost*0.01))))"},{type:"setValue",name:"flag:nowmdef",value:"(Math.floor((status:mdef)))"},{type:"while",condition:"1",data:[{type:"moveHero",time:2,steps:["forward:3"]},{type:"animate",name:"silversword",loc:[6,8],async:true},{type:"function","function":"function(){\ncore.addPop(6 * 32 + 16, 8 * 32 + 16, Math.max((core.getFlag('hatk') - core.getFlag('mdef')), Math.floor(core.getFlag('hatk') * 0.05)))\n}"},{type:"setValue",name:"flag:curattack",value:"(Math.max(Math.floor(flag:hatk-flag:mdef),Math.floor(flag:hatk*0.05)))"},{type:"setValue",name:"flag:mhp",operator:"-=",value:"flag:curattack"},{type:"setValue",name:"flag:mhp",operator:"max=",value:"0"},{type:"insert",name:"hp更新"},{type:"if",condition:"(flag:mhp<=0)","true":[{type:"hide",loc:[[6,8]],floorId:"MT0"},{type:"insert",name:"加点事件"},{type:"setValue",name:"flag:val0",operator:"+=",value:"1"},{type:"break",n:1}]},{type:"moveHero",time:2,steps:["backward:3"]},{type:"waitAsync"},{type:"sleep",time:10},{type:"move",loc:[6,8],time:2,keep:true,steps:["up:3"]},{type:"if",condition:"(flag:nowmdef>=(Math.max((flag:matk-flag:hdef),0)))","true":[{type:"function","function":"function(){\ncore.addPop(6 * 32 + 16, 4 * 32 + 16, Math.max((core.getFlag('matk') - core.getFlag('hdef')), Math.floor(core.getFlag('matk') * 0.05)), \"white\", \"white\")\n}"},{type:"animate",name:"hand",loc:[6,4],async:true},{type:"setValue",name:"flag:nowmdef",operator:"-=",value:"(Math.max((flag:matk-flag:hdef),0))"}],"false":[{type:"function","function":"function(){\ncore.addPop(6 * 32 + 16, 4 * 32 + 16, Math.max((core.getFlag('matk') - core.getFlag('hdef')), 0))\n}"},{type:"animate",name:"hand",loc:[6,4],async:true},{type:"setValue",name:"status:hp",operator:"-=",value:"(flag:matk-flag:hdef)-flag:nowmdef"},{type:"setValue",name:"flag:nowmdef",value:"0"}]},{type:"insert",name:"hp更新"},{type:"if",condition:"(status:hp<=0)","true":[{type:"insert",name:"死亡"}]},{type:"move",loc:[6,5],time:2,keep:true,steps:["down:3"]},{type:"waitAsync"},{type:"sleep",time:10}]},{type:"setValue",name:"status:money",operator:"+=",value:"1"},{type:"insert",name:"hp更新"},{type:"moveHero",time:2,steps:["backward:3"]},{type:"sleep",time:10},{type:"function","function":"function(){\ncore.setBlock('E' + ((core.getFlag(\"val0\") - 1) % 70 + 1), 6, 8)\n}"},{type:"show",loc:[[6,8]],floorId:"MT0",time:2},{type:"if",condition:"(flag:val0>=60)","true":[{type:"setValue",name:"flag:morihp",operator:"+=",value:"(core.rand(21)+30)"},{type:"setValue",name:"flag:matk",operator:"+=",value:"(core.rand(5)+4)"},{type:"setValue",name:"flag:mdef",operator:"+=",value:"(core.rand(3)+2)"},{type:"setValue",name:"flag:mhp",value:"flag:morihp"}],"false":[{type:"if",condition:"(flag:val0>=40)","true":[{type:"setValue",name:"flag:morihp",operator:"+=",value:"(core.rand(21)+25)"},{type:"setValue",name:"flag:matk",operator:"+=",value:"(core.rand(5)+3)"},{type:"setValue",name:"flag:mdef",operator:"+=",value:"(core.rand(3)+1)"},{type:"setValue",name:"flag:mhp",value:"flag:morihp"}],"false":[{type:"if",condition:"(flag:val0>=20)","true":[{type:"setValue",name:"flag:morihp",operator:"+=",value:"(core.rand(16)+20)"},{type:"setValue",name:"flag:matk",operator:"+=",value:"(core.rand(5)+2)"},{type:"setValue",name:"flag:mdef",operator:"+=",value:"(core.rand(3)+1)"},{type:"setValue",name:"flag:mhp",value:"flag:morihp"}],"false":[{type:"setValue",name:"flag:morihp",operator:"+=",value:"(core.rand(11)+20)"},{type:"setValue",name:"flag:morihp",operator:"*=",value:"1.5"},{type:"setValue",name:"flag:matk",operator:"+=",value:"(core.rand(6)+1)"},{type:"setValue",name:"flag:matk",operator:"*=",value:"1.5"},{type:"setValue",name:"flag:mdef",operator:"+=",value:"(core.rand(3)+1)"},{type:"setValue",name:"flag:mdef",operator:"*=",value:"1.5"},{type:"setValue",name:"flag:mhp",value:"flag:morihp"}]}]}]}]},{type:"setValue",name:"flag:score",operator:"+=",value:"status:hpmax"},{type:"setValue",name:"flag:score",operator:"+=",value:"((status:atk+status:def)*20)"},{type:"setValue",name:"flag:score",operator:"+=",value:"(status:mdef*5)"},{type:"win",reason:"成功过关！"}],"神器":[],"hp更新":[{type:"showImage",code:1,image:"life0.png",loc:[135,35],opacity:1,time:0},{type:"showImage",code:2,image:"life0.png",loc:[135,350],opacity:1,time:0},{type:"function","function":"function(){\ncore.clearMap(\"data\")\nvar ctx = 'data';\nvar f = 0;\nvar _fillBoldTextWithFontCheck = function (text, x, y, style) {\n\t// \t\t斜体判定：如果不是纯数字和字母，斜体会非常难看，需要取消\n\n\tif (!f) {\n\t\tif (!/^[-a-zA-Z0-9`~!@#$%^&*()_=+\\[{\\]}\\\\|;:'\",<.>\\/?]*$/.test(text))\n\t\t\tcore.setFont(ctx, ' bold 20px Verdana');\n\t\telse core.setFont(ctx, 'italic bold 20px Verdana');\n\t} else core.setFont(ctx, ' bold 20px Verdana');\n\tcore.fillBoldText(ctx, text, x, y, style);\n}\nvar pct = core.getStatus('hp') / (core.getStatus('hpmax'));\nvar tp, aaa;\nif (pct == 1) tp = 'lifeA.png';\nelse if (pct >= 0.75) tp = 'lifeB.png';\nelse if (pct >= 0.5) tp = 'lifeC.png';\nelse if (pct >= 0.25) tp = 'lifeD.png';\nelse {\n\ttp = 'lifeE.png';\n\tif (pct <= 0.01) core.setAlpha(ctx, pct * 70 + 0.3);\n}\nif (pct <= 0.01 && pct > 0) pct = 0.01;\nfor (var i = 1; i <= pct * 100; i++)\n\tcore.drawImage(ctx, tp, 138 + i * 1.1, 35, 32, 32);\ncore.setAlpha(ctx, 1);\n//core.drawImage(ctx, core.statusBar.icons.hp, 6, 83, 25, 25);\nf = 1;\n_fillBoldTextWithFontCheck(core.formatBigNumber(core.getRealStatus('hp')) + ' / ' + core.formatBigNumber(core.getStatus('hpmax')), 150, 65, \"#FF99FF\");\nf = 0;\n\npct = core.getFlag('mhp') / (core.getFlag('morihp'));\nvar tp, aaa;\nif (pct == 1) tp = 'lifeA.png';\nelse if (pct >= 0.75) tp = 'lifeB.png';\nelse if (pct >= 0.5) tp = 'lifeC.png';\nelse if (pct >= 0.25) tp = 'lifeD.png';\nelse {\n\ttp = 'lifeE.png';\n\tif (pct <= 0.01) core.setAlpha(ctx, pct * 70 + 0.3);\n}\nif (pct <= 0.01 && pct > 0) pct = 0.01;\nfor (var i = 1; i <= pct * 100; i++)\n\tcore.drawImage(ctx, tp, 138 + i * 1.1, 350, 32, 32);\ncore.setAlpha(ctx, 1);\n//core.drawImage(ctx, core.statusBar.icons.hp, 6, 83, 25, 25);\nf = 1;\n_fillBoldTextWithFontCheck(core.formatBigNumber(core.getFlag('mhp')) + ' / ' + core.formatBigNumber(core.getFlag('morihp')), 150, 380, \"#FF99FF\");\nf = 0;\nvar ctx = 'data';\npct = core.getFlag('nowmdef') / (core.getStatus('mdef'));\nif (pct <= 0.01 && pct > 0) pct = 0.01;\nfor (var i = 1; i <= pct * 100; i++)\n\tcore.drawImage(ctx, 'lifeF.png', 143 + i, 35, 32, 32);\ncore.setAlpha(ctx, 1);\nf = 1;\n_fillBoldTextWithFontCheck(core.formatBigNumber(core.getRealStatus('hp')) + ' / ' + core.formatBigNumber(core.getStatus('hpmax')), 150, 65, \"#FF99FF\");\n_fillBoldTextWithFontCheck(core.getFlag('nowmdef') + ' / ' + (core.getStatus('mdef')), 150, 95, \"lightblue\");\nf = 0;\n//core.drawImage(ctx, core.statusBar.icons.hp, 6, 83, 25, 25);\n}"}],"死亡":[{type:"setValue",name:"flag:score",operator:"+=",value:"(status:money*1000000)"},{type:"setValue",name:"flag:score",operator:"+=",value:"status:hpmax"},{type:"setValue",name:"flag:score",operator:"+=",value:"((status:atk+status:def)*20)"},{type:"setValue",name:"flag:score",operator:"+=",value:"(status:mdef*5)"},{type:"win",reason:"游戏结束！"}],"商店选择":null}};